(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.flvjs=e()}})(function(){var n,e,t;return function a(s,o,u){function l(r,e){if(!o[r]){if(!s[r]){var t=typeof require=="function"&&require;if(!e&&t)return t(r,!0);if(f)return f(r,!0);var i=new Error("Cannot find module '"+r+"'");throw i.code="MODULE_NOT_FOUND",i}var n=o[r]={exports:{}};s[r][0].call(n.exports,function(e){var t=s[r][1][e];return l(t?t:e)},n,n.exports,a,s,o,u)}return o[r].exports}var f=typeof require=="function"&&require;for(var e=0;e<u.length;e++)l(u[e]);return l}({1:[function(ue,r,i){(function(se,oe){(function(e,t){typeof i==="object"&&typeof r!=="undefined"?r.exports=t():typeof n==="function"&&n.amd?n(t):e.ES6Promise=t()})(this,function(){"use strict";function r(e){var t=typeof e;return e!==null&&(t==="object"||t==="function")}function l(e){return typeof e==="function"}var e=void 0;if(Array.isArray){e=Array.isArray}else{e=function(e){return Object.prototype.toString.call(e)==="[object Array]"}}var i=e;var n=0;var t=void 0;var a=void 0;var s=function e(t,r){E[n]=t;E[n+1]=r;n+=2;if(n===2){if(a){a(b)}else{k()}}};function o(e){a=e}function u(e){s=e}var f=typeof window!=="undefined"?window:undefined;var d=f||{};var h=d.MutationObserver||d.WebKitMutationObserver;var c=typeof self==="undefined"&&typeof se!=="undefined"&&{}.toString.call(se)==="[object process]";var _=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function v(){return function(){return se.nextTick(b)}}function m(){if(typeof t!=="undefined"){return function(){t(b)}}return y()}function p(){var e=0;var t=new h(b);var r=document.createTextNode("");t.observe(r,{characterData:true});return function(){r.data=e=++e%2}}function g(){var e=new MessageChannel;e.port1.onmessage=b;return function(){return e.port2.postMessage(0)}}function y(){var e=setTimeout;return function(){return e(b,1)}}var E=new Array(1e3);function b(){for(var e=0;e<n;e+=2){var t=E[e];var r=E[e+1];t(r);E[e]=undefined;E[e+1]=undefined}n=0}function S(){try{var e=Function("return this")().require("vertx");t=e.runOnLoop||e.runOnContext;return m()}catch(e){return y()}}var k=void 0;if(c){k=v()}else if(h){k=p()}else if(_){k=g()}else if(f===undefined&&typeof ue==="function"){k=S()}else{k=y()}function L(e,t){var r=this;var i=new this.constructor(A);if(i[R]===undefined){Z(i)}var n=r._state;if(n){var a=arguments[n-1];s(function(){return q(n,i,a,r._result)})}else{z(r,i,e,t)}return i}function w(e){var t=this;if(e&&typeof e==="object"&&e.constructor===t){return e}var r=new t(A);N(r,e);return r}var R=Math.random().toString(36).substring(2);function A(){}var T=void 0;var O=1;var C=2;var I={error:null};function D(){return new TypeError("You cannot resolve a promise with itself")}function x(){return new TypeError("A promises callback cannot return that same promise.")}function M(e){try{return e.then}catch(e){I.error=e;return I}}function B(e,t,r,i){try{e.call(t,r,i)}catch(e){return e}}function j(e,i,n){s(function(t){var r=false;var e=B(n,i,function(e){if(r){return}r=true;if(i!==e){N(t,e)}else{G(t,e)}},function(e){if(r){return}r=true;V(t,e)},"Settle: "+(t._label||" unknown promise"));if(!r&&e){r=true;V(t,e)}},e)}function P(t,e){if(e._state===O){G(t,e._result)}else if(e._state===C){V(t,e._result)}else{z(e,undefined,function(e){return N(t,e)},function(e){return V(t,e)})}}function U(e,t,r){if(t.constructor===e.constructor&&r===L&&t.constructor.resolve===w){P(e,t)}else{if(r===I){V(e,I.error);I.error=null}else if(r===undefined){G(e,t)}else if(l(r)){j(e,t,r)}else{G(e,t)}}}function N(e,t){if(e===t){V(e,D())}else if(r(t)){U(e,t,M(t))}else{G(e,t)}}function F(e){if(e._onerror){e._onerror(e._result)}H(e)}function G(e,t){if(e._state!==T){return}e._result=t;e._state=O;if(e._subscribers.length!==0){s(H,e)}}function V(e,t){if(e._state!==T){return}e._state=C;e._result=t;s(F,e)}function z(e,t,r,i){var n=e._subscribers;var a=n.length;e._onerror=null;n[a]=t;n[a+O]=r;n[a+C]=i;if(a===0&&e._state){s(H,e)}}function H(e){var t=e._subscribers;var r=e._state;if(t.length===0){return}var i=void 0,n=void 0,a=e._result;for(var s=0;s<t.length;s+=3){i=t[s];n=t[s+r];if(i){q(r,i,n,a)}else{n(a)}}e._subscribers.length=0}function K(e,t){try{return e(t)}catch(e){I.error=e;return I}}function q(e,t,r,i){var n=l(r),a=void 0,s=void 0,o=void 0,u=void 0;if(n){a=K(r,i);if(a===I){u=true;s=a.error;a.error=null}else{o=true}if(t===a){V(t,x());return}}else{a=i;o=true}if(t._state!==T){}else if(n&&o){N(t,a)}else if(u){V(t,s)}else if(e===O){G(t,a)}else if(e===C){V(t,a)}}function W(r,e){try{e(function e(t){N(r,t)},function e(t){V(r,t)})}catch(e){V(r,e)}}var X=0;function Y(){return X++}function Z(e){e[R]=X++;e._state=undefined;e._result=undefined;e._subscribers=[]}function Q(){return new Error("Array Methods must be provided an Array")}var J=function(){function e(e,t){this._instanceConstructor=e;this.promise=new e(A);if(!this.promise[R]){Z(this.promise)}if(i(t)){this.length=t.length;this._remaining=t.length;this._result=new Array(this.length);if(this.length===0){G(this.promise,this._result)}else{this.length=this.length||0;this._enumerate(t);if(this._remaining===0){G(this.promise,this._result)}}}else{V(this.promise,Q())}}e.prototype._enumerate=function e(t){for(var r=0;this._state===T&&r<t.length;r++){this._eachEntry(t[r],r)}};e.prototype._eachEntry=function e(t,r){var i=this._instanceConstructor;var n=i.resolve;if(n===w){var a=M(t);if(a===L&&t._state!==T){this._settledAt(t._state,r,t._result)}else if(typeof a!=="function"){this._remaining--;this._result[r]=t}else if(i===ne){var s=new i(A);U(s,t,a);this._willSettleAt(s,r)}else{this._willSettleAt(new i(function(e){return e(t)}),r)}}else{this._willSettleAt(n(t),r)}};e.prototype._settledAt=function e(t,r,i){var n=this.promise;if(n._state===T){this._remaining--;if(t===C){V(n,i)}else{this._result[r]=i}}if(this._remaining===0){G(n,this._result)}};e.prototype._willSettleAt=function e(t,r){var i=this;z(t,undefined,function(e){return i._settledAt(O,r,e)},function(e){return i._settledAt(C,r,e)})};return e}();function $(e){return new J(this,e).promise}function ee(n){var a=this;if(!i(n)){return new a(function(e,t){return t(new TypeError("You must pass an array to race."))})}else{return new a(function(e,t){var r=n.length;for(var i=0;i<r;i++){a.resolve(n[i]).then(e,t)}})}}function te(e){var t=this;var r=new t(A);V(r,e);return r}function re(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ie(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ne=function(){function t(e){this[R]=Y();this._result=this._state=undefined;this._subscribers=[];if(A!==e){typeof e!=="function"&&re();this instanceof t?W(this,e):ie()}}t.prototype.catch=function e(t){return this.then(null,t)};t.prototype.finally=function e(t){var r=this;var i=r.constructor;if(l(t)){return r.then(function(e){return i.resolve(t()).then(function(){return e})},function(e){return i.resolve(t()).then(function(){throw e})})}return r.then(t,t)};return t}();ne.prototype.then=L;ne.all=$;ne.race=ee;ne.resolve=w;ne.reject=te;ne._setScheduler=o;ne._setAsap=u;ne._asap=s;function ae(){var e=void 0;if(typeof oe!=="undefined"){e=oe}else if(typeof self!=="undefined"){e=self}else{try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if(r==="[object Promise]"&&!t.cast){return}}e.Promise=ne}ne.polyfill=ae;ne.Promise=ne;return ne})}).call(this,ue("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:3}],2:[function(e,t,r){function i(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}t.exports=i;i.EventEmitter=i;i.prototype._events=undefined;i.prototype._maxListeners=undefined;i.defaultMaxListeners=10;i.prototype.setMaxListeners=function(e){if(!n(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");this._maxListeners=e;return this};i.prototype.emit=function(e){var t,r,i,n,a,s;if(!this._events)this._events={};if(e==="error"){if(!this._events.error||l(this._events.error)&&!this._events.error.length){t=arguments[1];if(t instanceof Error){throw t}else{var o=new Error('Uncaught, unspecified "error" event. ('+t+")");o.context=t;throw o}}}r=this._events[e];if(f(r))return false;if(u(r)){switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1);r.apply(this,n)}}else if(l(r)){n=Array.prototype.slice.call(arguments,1);s=r.slice();i=s.length;for(a=0;a<i;a++)s[a].apply(this,n)}return true};i.prototype.addListener=function(e,t){var r;if(!u(t))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",e,u(t.listener)?t.listener:t);if(!this._events[e])this._events[e]=t;else if(l(this._events[e]))this._events[e].push(t);else this._events[e]=[this._events[e],t];if(l(this._events[e])&&!this._events[e].warned){if(!f(this._maxListeners)){r=this._maxListeners}else{r=i.defaultMaxListeners}if(r&&r>0&&this._events[e].length>r){this._events[e].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length);if(typeof console.trace==="function"){console.trace()}}}return this};i.prototype.on=i.prototype.addListener;i.prototype.once=function(e,t){if(!u(t))throw TypeError("listener must be a function");var r=false;function i(){this.removeListener(e,i);if(!r){r=true;t.apply(this,arguments)}}i.listener=t;this.on(e,i);return this};i.prototype.removeListener=function(e,t){var r,i,n,a;if(!u(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;r=this._events[e];n=r.length;i=-1;if(r===t||u(r.listener)&&r.listener===t){delete this._events[e];if(this._events.removeListener)this.emit("removeListener",e,t)}else if(l(r)){for(a=n;a-- >0;){if(r[a]===t||r[a].listener&&r[a].listener===t){i=a;break}}if(i<0)return this;if(r.length===1){r.length=0;delete this._events[e]}else{r.splice(i,1)}if(this._events.removeListener)this.emit("removeListener",e,t)}return this};i.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[e])delete this._events[e];return this}if(arguments.length===0){for(t in this._events){if(t==="removeListener")continue;this.removeAllListeners(t)}this.removeAllListeners("removeListener");this._events={};return this}r=this._events[e];if(u(r)){this.removeListener(e,r)}else if(r){while(r.length)this.removeListener(e,r[r.length-1])}delete this._events[e];return this};i.prototype.listeners=function(e){var t;if(!this._events||!this._events[e])t=[];else if(u(this._events[e]))t=[this._events[e]];else t=this._events[e].slice();return t};i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(u(t))return 1;else if(t)return t.length}return 0};i.listenerCount=function(e,t){return e.listenerCount(t)};function u(e){return typeof e==="function"}function n(e){return typeof e==="number"}function l(e){return typeof e==="object"&&e!==null}function f(e){return e===void 0}},{}],3:[function(e,t,r){var i=t.exports={};var n;var a;function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){n=setTimeout}else{n=s}}catch(e){n=s}try{if(typeof clearTimeout==="function"){a=clearTimeout}else{a=o}}catch(e){a=o}})();function u(t){if(n===setTimeout){return setTimeout(t,0)}if((n===s||!n)&&setTimeout){n=setTimeout;return setTimeout(t,0)}try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}function l(t){if(a===clearTimeout){return clearTimeout(t)}if((a===o||!a)&&clearTimeout){a=clearTimeout;return clearTimeout(t)}try{return a(t)}catch(e){try{return a.call(null,t)}catch(e){return a.call(this,t)}}}var f=[];var d=false;var h;var c=-1;function _(){if(!d||!h){return}d=false;if(h.length){f=h.concat(f)}else{c=-1}if(f.length){v()}}function v(){if(d){return}var e=u(_);d=true;var t=f.length;while(t){h=f;f=[];while(++c<t){if(h){h[c].run()}}c=-1;t=f.length}h=null;d=false;l(e)}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}}f.push(new m(e,t));if(f.length===1&&!d){u(v)}};function m(e,t){this.fun=e;this.array=t}m.prototype.run=function(){this.fun.apply(null,this.array)};i.title="browser";i.browser=true;i.env={};i.argv=[];i.version="";i.versions={};function p(){}i.on=p;i.addListener=p;i.once=p;i.off=p;i.removeListener=p;i.removeAllListeners=p;i.emit=p;i.prependListener=p;i.prependOnceListener=p;i.listeners=function(e){return[]};i.binding=function(e){throw new Error("process.binding is not supported")};i.cwd=function(){return"/"};i.chdir=function(e){throw new Error("process.chdir is not supported")};i.umask=function(){return 0}},{}],4:[function(e,t,r){var g=arguments[3];var y=arguments[4];var E=arguments[5];var b=JSON.stringify;t.exports=function(e,t){var r;var i=Object.keys(E);for(var n=0,a=i.length;n<a;n++){var s=i[n];var o=E[s].exports;if(o===e||o&&o.default===e){r=s;break}}if(!r){r=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var u={};for(var n=0,a=i.length;n<a;n++){var s=i[n];u[s]=s}y[r]=["function(require,module,exports){"+e+"(self); }",u]}var l=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var f={};f[r]=r;y[l]=["function(require,module,exports){"+"var f = require("+b(r)+");"+"(f.default ? f.default : f)(self);"+"}",f];var d={};h(l);function h(e){d[e]=true;for(var t in y[e][1]){var r=y[e][1][t];if(!d[r]){h(r)}}}var c="("+g+")({"+Object.keys(d).map(function(e){return b(e)+":["+y[e][0]+","+b(y[e][1])+"]"}).join(",")+"},{},["+b(l)+"])";var _=window.URL||window.webkitURL||window.mozURL||window.msURL;var v=new Blob([c],{type:"text/javascript"});if(t&&t.bare){return v}var m=_.createObjectURL(v);var p=new Worker(m);p.objectURL=m;return p}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.createDefaultConfig=n;var i=r.defaultConfig={enableWorker:false,enableStashBuffer:true,stashInitialSize:undefined,isLive:false,lazyLoad:true,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:true,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:true,accurateSeek:false,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:false,customSeekHandler:undefined,reuseRedirectedURL:false,headers:undefined,customLoader:undefined};function n(){return Object.assign({},i)}},{}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var i=e("../io/io-controller.js");var a=o(i);var s=e("../config.js");function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var l=function(){function i(){u(this,i)}n(i,null,[{key:"supportMSEH264Playback",value:function e(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"supportNetworkStreamIO",value:function e(){var t=new a.default({},(0,s.createDefaultConfig)());var r=t.loaderType;t.destroy();return r=="fetch-stream-loader"||r=="xhr-moz-chunked-loader"}},{key:"getNetworkLoaderTypeName",value:function e(){var t=new a.default({},(0,s.createDefaultConfig)());var r=t.loaderType;t.destroy();return r}},{key:"supportNativeMediaPlayback",value:function e(t){if(i.videoElement==undefined){i.videoElement=window.document.createElement("video")}var r=i.videoElement.canPlayType(t);return r==="probably"||r=="maybe"}},{key:"getFeatureList",value:function e(){var t={mseFlvPlayback:false,mseLiveFlvPlayback:false,networkStreamIO:false,networkLoaderName:"",nativeMP4H264Playback:false,nativeWebmVP8Playback:false,nativeWebmVP9Playback:false};t.mseFlvPlayback=i.supportMSEH264Playback();t.networkStreamIO=i.supportNetworkStreamIO();t.networkLoaderName=i.getNetworkLoaderTypeName();t.mseLiveFlvPlayback=t.mseFlvPlayback&&t.networkStreamIO;t.nativeMP4H264Playback=i.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"');t.nativeWebmVP8Playback=i.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"');t.nativeWebmVP9Playback=i.supportNativeMediaPlayback('video/webm; codecs="vp9"');return t}}]);return i}();r.default=l},{"../config.js":5,"../io/io-controller.js":23}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e);this.mimeType=null;this.duration=null;this.hasAudio=null;this.hasVideo=null;this.audioCodec=null;this.videoCodec=null;this.audioDataRate=null;this.videoDataRate=null;this.audioSampleRate=null;this.audioChannelCount=null;this.width=null;this.height=null;this.fps=null;this.profile=null;this.level=null;this.refFrames=null;this.chromaFormat=null;this.sarNum=null;this.sarDen=null;this.metadata=null;this.segments=null;this.segmentCount=null;this.hasKeyframesIndex=null;this.keyframesIndex=null}i(e,[{key:"isComplete",value:function e(){var t=this.hasAudio===false||this.hasAudio===true&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null;var r=this.hasVideo===false||this.hasVideo===true&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&t&&r}},{key:"isSeekable",value:function e(){return this.hasKeyframesIndex===true}},{key:"getNearestKeyframe",value:function e(t){if(this.keyframesIndex==null){return null}var r=this.keyframesIndex;var i=this._search(r.times,t);return{index:i,milliseconds:r.times[i],fileposition:r.filepositions[i]}}},{key:"_search",value:function e(t,r){var i=0;var n=t.length-1;var a=0;var s=0;var o=n;if(r<t[0]){i=0;s=o+1}while(s<=o){a=s+Math.floor((o-s)/2);if(a===n||r>=t[a]&&r<t[a+1]){i=a;break}else if(t[a]<r){s=a+1}else{o=a-1}}return i}}]);return e}();r.default=a},{}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var n=r.SampleInfo=function e(t,r,i,n,a){s(this,e);this.dts=t;this.pts=r;this.duration=i;this.originalDts=n;this.isSyncPoint=a;this.fileposition=null};var a=r.MediaSegmentInfo=function(){function e(){s(this,e);this.beginDts=0;this.endDts=0;this.beginPts=0;this.endPts=0;this.originalBeginDts=0;this.originalEndDts=0;this.syncPoints=[];this.firstSample=null;this.lastSample=null}i(e,[{key:"appendSyncPoint",value:function e(t){t.isSyncPoint=true;this.syncPoints.push(t)}}]);return e}();var o=r.IDRSampleList=function(){function e(){s(this,e);this._list=[]}i(e,[{key:"clear",value:function e(){this._list=[]}},{key:"appendArray",value:function e(t){var r=this._list;if(t.length===0){return}if(r.length>0&&t[0].originalDts<r[r.length-1].originalDts){this.clear()}Array.prototype.push.apply(r,t)}},{key:"getLastSyncPointBeforeDts",value:function e(t){if(this._list.length==0){return null}var r=this._list;var i=0;var n=r.length-1;var a=0;var s=0;var o=n;if(t<r[0].dts){i=0;s=o+1}while(s<=o){a=s+Math.floor((o-s)/2);if(a===n||t>=r[a].dts&&t<r[a+1].dts){i=a;break}else if(r[a].dts<t){s=a+1}else{o=a-1}}return this._list[i]}}]);return e}();var u=r.MediaSegmentInfoList=function(){function t(e){s(this,t);this._type=e;this._list=[];this._lastAppendLocation=-1}i(t,[{key:"isEmpty",value:function e(){return this._list.length===0}},{key:"clear",value:function e(){this._list=[];this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function e(t){var r=this._list;if(r.length===0){return-2}var i=r.length-1;var n=0;var a=0;var s=i;var o=0;if(t<r[0].originalBeginDts){o=-1;return o}while(a<=s){n=a+Math.floor((s-a)/2);if(n===i||t>r[n].lastSample.originalDts&&t<r[n+1].originalBeginDts){o=n;break}else if(r[n].originalBeginDts<t){a=n+1}else{s=n-1}}return o}},{key:"_searchNearestSegmentAfter",value:function e(t){return this._searchNearestSegmentBefore(t)+1}},{key:"append",value:function e(t){var r=this._list;var i=t;var n=this._lastAppendLocation;var a=0;if(n!==-1&&n<r.length&&i.originalBeginDts>=r[n].lastSample.originalDts&&(n===r.length-1||n<r.length-1&&i.originalBeginDts<r[n+1].originalBeginDts)){a=n+1}else{if(r.length>0){a=this._searchNearestSegmentBefore(i.originalBeginDts)+1}}this._lastAppendLocation=a;this._list.splice(a,0,i)}},{key:"getLastSegmentBefore",value:function e(t){var r=this._searchNearestSegmentBefore(t);if(r>=0){return this._list[r]}else{return null}}},{key:"getLastSampleBefore",value:function e(t){var r=this.getLastSegmentBefore(t);if(r!=null){return r.lastSample}else{return null}}},{key:"getLastSyncPointBefore",value:function e(t){var r=this._searchNearestSegmentBefore(t);var i=this._list[r].syncPoints;while(i.length===0&&r>0){r--;i=this._list[r].syncPoints}if(i.length>0){return i[i.length-1]}else{return null}}},{key:"type",get:function e(){return this._type}},{key:"length",get:function e(){return this._list.length}}]);return t}()},{}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var n=e("events");var a=_(n);var s=e("../utils/logger.js");var l=_(s);var o=e("../utils/browser.js");var f=_(o);var u=e("./mse-events.js");var d=_(u);var h=e("./media-segment-info.js");var c=e("../utils/exception.js");function _(e){return e&&e.__esModule?e:{default:e}}function v(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var m=function(){function t(e){v(this,t);this.TAG="MSEController";this._config=e;this._emitter=new a.default;if(this._config.isLive&&this._config.autoCleanupSourceBuffer==undefined){this._config.autoCleanupSourceBuffer=true}this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)};this._mediaSource=null;this._mediaSourceObjectURL=null;this._mediaElement=null;this._isBufferFull=false;this._hasPendingEos=false;this._requireSetMediaDuration=false;this._pendingMediaDuration=0;this._pendingSourceBufferInit=[];this._mimeTypes={video:null,audio:null};this._sourceBuffers={video:null,audio:null};this._lastInitSegments={video:null,audio:null};this._pendingSegments={video:[],audio:[]};this._pendingRemoveRanges={video:[],audio:[]};this._idrList=new h.IDRSampleList}i(t,[{key:"destroy",value:function e(){if(this._mediaElement||this._mediaSource){this.detachMediaElement()}this.e=null;this._emitter.removeAllListeners();this._emitter=null}},{key:"on",value:function e(t,r){this._emitter.addListener(t,r)}},{key:"off",value:function e(t,r){this._emitter.removeListener(t,r)}},{key:"attachMediaElement",value:function e(t){if(this._mediaSource){throw new c.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!")}var r=this._mediaSource=new window.MediaSource;r.addEventListener("sourceopen",this.e.onSourceOpen);r.addEventListener("sourceended",this.e.onSourceEnded);r.addEventListener("sourceclose",this.e.onSourceClose);this._mediaElement=t;this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource);t.src=this._mediaSourceObjectURL}},{key:"detachMediaElement",value:function e(){if(this._mediaSource){var t=this._mediaSource;for(var r in this._sourceBuffers){var i=this._pendingSegments[r];i.splice(0,i.length);this._pendingSegments[r]=null;this._pendingRemoveRanges[r]=null;this._lastInitSegments[r]=null;var n=this._sourceBuffers[r];if(n){if(t.readyState!=="closed"){try{t.removeSourceBuffer(n)}catch(e){l.default.e(this.TAG,e.message)}n.removeEventListener("error",this.e.onSourceBufferError);n.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[r]=null;this._sourceBuffers[r]=null}}if(t.readyState==="open"){try{t.endOfStream()}catch(e){l.default.e(this.TAG,e.message)}}t.removeEventListener("sourceopen",this.e.onSourceOpen);t.removeEventListener("sourceended",this.e.onSourceEnded);t.removeEventListener("sourceclose",this.e.onSourceClose);this._pendingSourceBufferInit=[];this._isBufferFull=false;this._idrList.clear();this._mediaSource=null}if(this._mediaElement){this._mediaElement.src="";this._mediaElement.removeAttribute("src");this._mediaElement=null}if(this._mediaSourceObjectURL){window.URL.revokeObjectURL(this._mediaSourceObjectURL);this._mediaSourceObjectURL=null}}},{key:"appendInitSegment",value:function e(t,r){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(t);this._pendingSegments[t.type].push(t);return}var i=t;var n=""+i.container;if(i.codec&&i.codec.length>0){n+=";codecs="+i.codec}var a=false;l.default.v(this.TAG,"Received Initialization Segment, mimeType: "+n);this._lastInitSegments[i.type]=i;if(n!==this._mimeTypes[i.type]){if(!this._mimeTypes[i.type]){a=true;try{var s=this._sourceBuffers[i.type]=this._mediaSource.addSourceBuffer(n);s.addEventListener("error",this.e.onSourceBufferError);s.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(e){l.default.e(this.TAG,e.message);this._emitter.emit(d.default.ERROR,{code:e.code,msg:e.message});return}}else{l.default.v(this.TAG,"Notice: "+i.type+" mimeType changed, origin: "+this._mimeTypes[i.type]+", target: "+n)}this._mimeTypes[i.type]=n}if(!r){this._pendingSegments[i.type].push(i)}if(!a){if(this._sourceBuffers[i.type]&&!this._sourceBuffers[i.type].updating){this._doAppendSegments()}}if(f.default.safari&&i.container==="audio/mpeg"&&i.mediaDuration>0){this._requireSetMediaDuration=true;this._pendingMediaDuration=i.mediaDuration/1e3;this._updateMediaSourceDuration()}}},{key:"appendMediaSegment",value:function e(t){var r=t;this._pendingSegments[r.type].push(r);if(this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()){this._doCleanupSourceBuffer()}var i=this._sourceBuffers[r.type];if(i&&!i.updating&&!this._hasPendingRemoveRanges()){this._doAppendSegments()}}},{key:"seek",value:function e(t){for(var r in this._sourceBuffers){if(!this._sourceBuffers[r]){continue}var i=this._sourceBuffers[r];if(this._mediaSource.readyState==="open"){try{i.abort()}catch(e){l.default.e(this.TAG,e.message)}}this._idrList.clear();var n=this._pendingSegments[r];n.splice(0,n.length);if(this._mediaSource.readyState==="closed"){continue}for(var a=0;a<i.buffered.length;a++){var s=i.buffered.start(a);var o=i.buffered.end(a);this._pendingRemoveRanges[r].push({start:s,end:o})}if(!i.updating){this._doRemoveRanges()}if(f.default.safari){var u=this._lastInitSegments[r];if(u){this._pendingSegments[r].push(u);if(!i.updating){this._doAppendSegments()}}}}}},{key:"endOfStream",value:function e(){var t=this._mediaSource;var r=this._sourceBuffers;if(!t||t.readyState!=="open"){if(t&&t.readyState==="closed"&&this._hasPendingSegments()){this._hasPendingEos=true}return}if(r.video&&r.video.updating||r.audio&&r.audio.updating){this._hasPendingEos=true}else{this._hasPendingEos=false;t.endOfStream()}}},{key:"getNearestKeyframe",value:function e(t){return this._idrList.getLastSyncPointBeforeDts(t)}},{key:"_needCleanupSourceBuffer",value:function e(){if(!this._config.autoCleanupSourceBuffer){return false}var t=this._mediaElement.currentTime;for(var r in this._sourceBuffers){var i=this._sourceBuffers[r];if(i){var n=i.buffered;if(n.length>=1){if(t-n.start(0)>=this._config.autoCleanupMaxBackwardDuration){return true}}}}return false}},{key:"_doCleanupSourceBuffer",value:function e(){var t=this._mediaElement.currentTime;for(var r in this._sourceBuffers){var i=this._sourceBuffers[r];if(i){var n=i.buffered;var a=false;for(var s=0;s<n.length;s++){var o=n.start(s);var u=n.end(s);if(o<=t&&t<u+3){if(t-o>=this._config.autoCleanupMaxBackwardDuration){a=true;var l=t-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[r].push({start:o,end:l})}}else if(u<t){a=true;this._pendingRemoveRanges[r].push({start:o,end:u})}}if(a&&!i.updating){this._doRemoveRanges()}}}}},{key:"_updateMediaSourceDuration",value:function e(){var t=this._sourceBuffers;if(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open"){return}if(t.video&&t.video.updating||t.audio&&t.audio.updating){return}var r=this._mediaSource.duration;var i=this._pendingMediaDuration;if(i>0&&(isNaN(r)||i>r)){l.default.v(this.TAG,"Update MediaSource duration from "+r+" to "+i);this._mediaSource.duration=i}this._requireSetMediaDuration=false;this._pendingMediaDuration=0}},{key:"_doRemoveRanges",value:function e(){for(var t in this._pendingRemoveRanges){if(!this._sourceBuffers[t]||this._sourceBuffers[t].updating){continue}var r=this._sourceBuffers[t];var i=this._pendingRemoveRanges[t];while(i.length&&!r.updating){var n=i.shift();r.remove(n.start,n.end)}}}},{key:"_doAppendSegments",value:function e(){var t=this._pendingSegments;for(var r in t){if(!this._sourceBuffers[r]||this._sourceBuffers[r].updating){continue}if(t[r].length>0){var i=t[r].shift();if(i.timestampOffset){var n=this._sourceBuffers[r].timestampOffset;var a=i.timestampOffset/1e3;var s=Math.abs(n-a);if(s>.1){l.default.v(this.TAG,"Update MPEG audio timestampOffset from "+n+" to "+a);this._sourceBuffers[r].timestampOffset=a}delete i.timestampOffset}if(!i.data||i.data.byteLength===0){continue}try{this._sourceBuffers[r].appendBuffer(i.data);this._isBufferFull=false;if(r==="video"&&i.hasOwnProperty("info")){this._idrList.appendArray(i.info.syncPoints)}}catch(e){this._pendingSegments[r].unshift(i);if(e.code===22){if(!this._isBufferFull){this._emitter.emit(d.default.BUFFER_FULL)}this._isBufferFull=true}else{l.default.e(this.TAG,e.message);this._emitter.emit(d.default.ERROR,{code:e.code,msg:e.message})}}}}}},{key:"_onSourceOpen",value:function e(){l.default.v(this.TAG,"MediaSource onSourceOpen");this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen);if(this._pendingSourceBufferInit.length>0){var t=this._pendingSourceBufferInit;while(t.length){var r=t.shift();this.appendInitSegment(r,true)}}if(this._hasPendingSegments()){this._doAppendSegments()}this._emitter.emit(d.default.SOURCE_OPEN)}},{key:"_onSourceEnded",value:function e(){l.default.v(this.TAG,"MediaSource onSourceEnded")}},{key:"_onSourceClose",value:function e(){l.default.v(this.TAG,"MediaSource onSourceClose");if(this._mediaSource&&this.e!=null){this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen);this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded);this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose)}}},{key:"_hasPendingSegments",value:function e(){var t=this._pendingSegments;return t.video.length>0||t.audio.length>0}},{key:"_hasPendingRemoveRanges",value:function e(){var t=this._pendingRemoveRanges;return t.video.length>0||t.audio.length>0}},{key:"_onSourceBufferUpdateEnd",value:function e(){if(this._requireSetMediaDuration){this._updateMediaSourceDuration()}else if(this._hasPendingRemoveRanges()){this._doRemoveRanges()}else if(this._hasPendingSegments()){this._doAppendSegments()}else if(this._hasPendingEos){this.endOfStream()}this._emitter.emit(d.default.UPDATE_END)}},{key:"_onSourceBufferError",value:function e(t){l.default.e(this.TAG,"SourceBuffer Error: "+t)}}]);return t}();r.default=m},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./media-segment-info.js":8,"./mse-events.js":10,events:2}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};r.default=i},{}],11:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var i=a("events");var s=g(i);var n=a("../utils/logger.js");var o=g(n);var u=a("../utils/logging-control.js");var l=g(u);var f=a("./transmuxing-controller.js");var d=g(f);var h=a("./transmuxing-events.js");var c=g(h);var _=a("./transmuxing-worker.js");var v=g(_);var m=a("./media-info.js");var p=g(m);function g(e){return e&&e.__esModule?e:{default:e}}function y(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var E=function(){function n(t,r){y(this,n);this.TAG="Transmuxer";this._emitter=new s.default;if(r.enableWorker&&typeof Worker!=="undefined"){try{var e=a("webworkify");this._worker=e(v.default);this._workerDestroying=false;this._worker.addEventListener("message",this._onWorkerMessage.bind(this));this._worker.postMessage({cmd:"init",param:[t,r]});this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)};l.default.registerListener(this.e.onLoggingConfigChanged);this._worker.postMessage({cmd:"logging_config",param:l.default.getConfig()})}catch(e){o.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing");this._worker=null;this._controller=new d.default(t,r)}}else{this._controller=new d.default(t,r)}if(this._controller){var i=this._controller;i.on(c.default.IO_ERROR,this._onIOError.bind(this));i.on(c.default.DEMUX_ERROR,this._onDemuxError.bind(this));i.on(c.default.INIT_SEGMENT,this._onInitSegment.bind(this));i.on(c.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this));i.on(c.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this));i.on(c.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this));i.on(c.default.MEDIA_INFO,this._onMediaInfo.bind(this));i.on(c.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this));i.on(c.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this));i.on(c.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this));i.on(c.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}r(n,[{key:"destroy",value:function e(){if(this._worker){if(!this._workerDestroying){this._workerDestroying=true;this._worker.postMessage({cmd:"destroy"});l.default.removeListener(this.e.onLoggingConfigChanged);this.e=null}}else{this._controller.destroy();this._controller=null}this._emitter.removeAllListeners();this._emitter=null}},{key:"on",value:function e(t,r){this._emitter.addListener(t,r)}},{key:"off",value:function e(t,r){this._emitter.removeListener(t,r)}},{key:"hasWorker",value:function e(){return this._worker!=null}},{key:"open",value:function e(){if(this._worker){this._worker.postMessage({cmd:"start"})}else{this._controller.start()}}},{key:"close",value:function e(){if(this._worker){this._worker.postMessage({cmd:"stop"})}else{this._controller.stop()}}},{key:"seek",value:function e(t){if(this._worker){this._worker.postMessage({cmd:"seek",param:t})}else{this._controller.seek(t)}}},{key:"pause",value:function e(){if(this._worker){this._worker.postMessage({cmd:"pause"})}else{this._controller.pause()}}},{key:"resume",value:function e(){if(this._worker){this._worker.postMessage({cmd:"resume"})}else{this._controller.resume()}}},{key:"_onInitSegment",value:function e(t,r){var i=this;Promise.resolve().then(function(){i._emitter.emit(c.default.INIT_SEGMENT,t,r)})}},{key:"_onMediaSegment",value:function e(t,r){var i=this;Promise.resolve().then(function(){i._emitter.emit(c.default.MEDIA_SEGMENT,t,r)})}},{key:"_onLoadingComplete",value:function e(){var t=this;Promise.resolve().then(function(){t._emitter.emit(c.default.LOADING_COMPLETE)})}},{key:"_onRecoveredEarlyEof",value:function e(){var t=this;Promise.resolve().then(function(){t._emitter.emit(c.default.RECOVERED_EARLY_EOF)})}},{key:"_onMediaInfo",value:function e(t){var r=this;Promise.resolve().then(function(){r._emitter.emit(c.default.MEDIA_INFO,t)})}},{key:"_onMetaDataArrived",value:function e(t){var r=this;Promise.resolve().then(function(){r._emitter.emit(c.default.METADATA_ARRIVED,t)})}},{key:"_onScriptDataArrived",value:function e(t){var r=this;Promise.resolve().then(function(){r._emitter.emit(c.default.SCRIPTDATA_ARRIVED,t)})}},{key:"_onStatisticsInfo",value:function e(t){var r=this;Promise.resolve().then(function(){r._emitter.emit(c.default.STATISTICS_INFO,t)})}},{key:"_onIOError",value:function e(t,r){var i=this;Promise.resolve().then(function(){i._emitter.emit(c.default.IO_ERROR,t,r)})}},{key:"_onDemuxError",value:function e(t,r){var i=this;Promise.resolve().then(function(){i._emitter.emit(c.default.DEMUX_ERROR,t,r)})}},{key:"_onRecommendSeekpoint",value:function e(t){var r=this;Promise.resolve().then(function(){r._emitter.emit(c.default.RECOMMEND_SEEKPOINT,t)})}},{key:"_onLoggingConfigChanged",value:function e(t){if(this._worker){this._worker.postMessage({cmd:"logging_config",param:t})}}},{key:"_onWorkerMessage",value:function e(t){var r=t.data;var i=r.data;if(r.msg==="destroyed"||this._workerDestroying){this._workerDestroying=false;this._worker.terminate();this._worker=null;return}switch(r.msg){case c.default.INIT_SEGMENT:case c.default.MEDIA_SEGMENT:this._emitter.emit(r.msg,i.type,i.data);break;case c.default.LOADING_COMPLETE:case c.default.RECOVERED_EARLY_EOF:this._emitter.emit(r.msg);break;case c.default.MEDIA_INFO:Object.setPrototypeOf(i,p.default.prototype);this._emitter.emit(r.msg,i);break;case c.default.METADATA_ARRIVED:case c.default.SCRIPTDATA_ARRIVED:case c.default.STATISTICS_INFO:this._emitter.emit(r.msg,i);break;case c.default.IO_ERROR:case c.default.DEMUX_ERROR:this._emitter.emit(r.msg,i.type,i.info);break;case c.default.RECOMMEND_SEEKPOINT:this._emitter.emit(r.msg,i);break;case"logcat_callback":o.default.emitter.emit("log",i.type,i.logcat);break;default:break}}}]);return n}();t.default=E},{"../utils/logger.js":41,"../utils/logging-control.js":42,"./media-info.js":7,"./transmuxing-controller.js":12,"./transmuxing-events.js":13,"./transmuxing-worker.js":14,events:2,webworkify:4}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var n=e("events");var a=k(n);var s=e("../utils/logger.js");var o=k(s);var u=e("../utils/browser.js");var l=k(u);var f=e("./media-info.js");var d=k(f);var h=e("../demux/flv-demuxer.js");var c=k(h);var _=e("../remux/mp4-remuxer.js");var v=k(_);var m=e("../demux/demux-errors.js");var p=k(m);var g=e("../io/io-controller.js");var y=k(g);var E=e("./transmuxing-events.js");var b=k(E);var S=e("../io/loader.js");function k(e){return e&&e.__esModule?e:{default:e}}function L(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var w=function(){function e(t,r){L(this,e);this.TAG="TransmuxingController";this._emitter=new a.default;this._config=r;if(!t.segments){t.segments=[{duration:t.duration,filesize:t.filesize,url:t.url}]}if(typeof t.cors!=="boolean"){t.cors=true}if(typeof t.withCredentials!=="boolean"){t.withCredentials=false}this._mediaDataSource=t;this._currentSegmentIndex=0;var i=0;this._mediaDataSource.segments.forEach(function(e){e.timestampBase=i;i+=e.duration;e.cors=t.cors;e.withCredentials=t.withCredentials;if(r.referrerPolicy){e.referrerPolicy=r.referrerPolicy}});if(!isNaN(i)&&this._mediaDataSource.duration!==i){this._mediaDataSource.duration=i}this._mediaInfo=null;this._demuxer=null;this._remuxer=null;this._ioctl=null;this._pendingSeekTime=null;this._pendingResolveSeekPoint=null;this._statisticsReporter=null}i(e,[{key:"destroy",value:function e(){this._mediaInfo=null;this._mediaDataSource=null;if(this._statisticsReporter){this._disableStatisticsReporter()}if(this._ioctl){this._ioctl.destroy();this._ioctl=null}if(this._demuxer){this._demuxer.destroy();this._demuxer=null}if(this._remuxer){this._remuxer.destroy();this._remuxer=null}this._emitter.removeAllListeners();this._emitter=null}},{key:"on",value:function e(t,r){this._emitter.addListener(t,r)}},{key:"off",value:function e(t,r){this._emitter.removeListener(t,r)}},{key:"start",value:function e(){this._loadSegment(0);this._enableStatisticsReporter()}},{key:"_loadSegment",value:function e(t,r){this._currentSegmentIndex=t;var i=this._mediaDataSource.segments[t];var n=this._ioctl=new y.default(i,this._config,t);n.onError=this._onIOException.bind(this);n.onSeeked=this._onIOSeeked.bind(this);n.onComplete=this._onIOComplete.bind(this);n.onRedirect=this._onIORedirect.bind(this);n.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this);if(r){this._demuxer.bindDataSource(this._ioctl)}else{n.onDataArrival=this._onInitChunkArrival.bind(this)}n.open(r)}},{key:"stop",value:function e(){this._internalAbort();this._disableStatisticsReporter()}},{key:"_internalAbort",value:function e(){if(this._ioctl){this._ioctl.destroy();this._ioctl=null}}},{key:"pause",value:function e(){if(this._ioctl&&this._ioctl.isWorking()){this._ioctl.pause();this._disableStatisticsReporter()}}},{key:"resume",value:function e(){if(this._ioctl&&this._ioctl.isPaused()){this._ioctl.resume();this._enableStatisticsReporter()}}},{key:"seek",value:function e(t){if(this._mediaInfo==null||!this._mediaInfo.isSeekable()){return}var r=this._searchSegmentIndexContains(t);if(r===this._currentSegmentIndex){var i=this._mediaInfo.segments[r];if(i==undefined){this._pendingSeekTime=t}else{var n=i.getNearestKeyframe(t);this._remuxer.seek(n.milliseconds);this._ioctl.seek(n.fileposition);this._pendingResolveSeekPoint=n.milliseconds}}else{var a=this._mediaInfo.segments[r];if(a==undefined){this._pendingSeekTime=t;this._internalAbort();this._remuxer.seek();this._remuxer.insertDiscontinuity();this._loadSegment(r)}else{var s=a.getNearestKeyframe(t);this._internalAbort();this._remuxer.seek(t);this._remuxer.insertDiscontinuity();this._demuxer.resetMediaInfo();this._demuxer.timestampBase=this._mediaDataSource.segments[r].timestampBase;this._loadSegment(r,s.fileposition);this._pendingResolveSeekPoint=s.milliseconds;this._reportSegmentMediaInfo(r)}}this._enableStatisticsReporter()}},{key:"_searchSegmentIndexContains",value:function e(t){var r=this._mediaDataSource.segments;var i=r.length-1;for(var n=0;n<r.length;n++){if(t<r[n].timestampBase){i=n-1;break}}return i}},{key:"_onInitChunkArrival",value:function e(t,r){var i=this;var n=null;var a=0;if(r>0){this._demuxer.bindDataSource(this._ioctl);this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase;a=this._demuxer.parseChunks(t,r)}else if((n=c.default.probe(t)).match){this._demuxer=new c.default(n,this._config);if(!this._remuxer){this._remuxer=new v.default(this._config)}var s=this._mediaDataSource;if(s.duration!=undefined&&!isNaN(s.duration)){this._demuxer.overridedDuration=s.duration}if(typeof s.hasAudio==="boolean"){this._demuxer.overridedHasAudio=s.hasAudio}if(typeof s.hasVideo==="boolean"){this._demuxer.overridedHasVideo=s.hasVideo}this._demuxer.timestampBase=s.segments[this._currentSegmentIndex].timestampBase;this._demuxer.onError=this._onDemuxException.bind(this);this._demuxer.onMediaInfo=this._onMediaInfo.bind(this);this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this);this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this);this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl));this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this);this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this);a=this._demuxer.parseChunks(t,r)}else{n=null;o.default.e(this.TAG,"Non-FLV, Unsupported media type!");Promise.resolve().then(function(){i._internalAbort()});this._emitter.emit(b.default.DEMUX_ERROR,p.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type");a=0}return a}},{key:"_onMediaInfo",value:function e(t){var r=this;if(this._mediaInfo==null){this._mediaInfo=Object.assign({},t);this._mediaInfo.keyframesIndex=null;this._mediaInfo.segments=[];this._mediaInfo.segmentCount=this._mediaDataSource.segments.length;Object.setPrototypeOf(this._mediaInfo,d.default.prototype)}var i=Object.assign({},t);Object.setPrototypeOf(i,d.default.prototype);this._mediaInfo.segments[this._currentSegmentIndex]=i;this._reportSegmentMediaInfo(this._currentSegmentIndex);if(this._pendingSeekTime!=null){Promise.resolve().then(function(){var e=r._pendingSeekTime;r._pendingSeekTime=null;r.seek(e)})}}},{key:"_onMetaDataArrived",value:function e(t){this._emitter.emit(b.default.METADATA_ARRIVED,t)}},{key:"_onScriptDataArrived",value:function e(t){this._emitter.emit(b.default.SCRIPTDATA_ARRIVED,t)}},{key:"_onIOSeeked",value:function e(){this._remuxer.insertDiscontinuity()}},{key:"_onIOComplete",value:function e(t){var r=t;var i=r+1;if(i<this._mediaDataSource.segments.length){this._internalAbort();this._remuxer.flushStashedSamples();this._loadSegment(i)}else{this._remuxer.flushStashedSamples();this._emitter.emit(b.default.LOADING_COMPLETE);this._disableStatisticsReporter()}}},{key:"_onIORedirect",value:function e(t){var r=this._ioctl.extraData;this._mediaDataSource.segments[r].redirectedURL=t}},{key:"_onIORecoveredEarlyEof",value:function e(){this._emitter.emit(b.default.RECOVERED_EARLY_EOF)}},{key:"_onIOException",value:function e(t,r){o.default.e(this.TAG,"IOException: type = "+t+", code = "+r.code+", msg = "+r.msg);this._emitter.emit(b.default.IO_ERROR,t,r);this._disableStatisticsReporter()}},{key:"_onDemuxException",value:function e(t,r){o.default.e(this.TAG,"DemuxException: type = "+t+", info = "+r);this._emitter.emit(b.default.DEMUX_ERROR,t,r)}},{key:"_onRemuxerInitSegmentArrival",value:function e(t,r){this._emitter.emit(b.default.INIT_SEGMENT,t,r)}},{key:"_onRemuxerMediaSegmentArrival",value:function e(t,r){if(this._pendingSeekTime!=null){return}this._emitter.emit(b.default.MEDIA_SEGMENT,t,r);if(this._pendingResolveSeekPoint!=null&&t==="video"){var i=r.info.syncPoints;var n=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null;if(l.default.safari&&i.length>0&&i[0].originalDts===n){n=i[0].pts}this._emitter.emit(b.default.RECOMMEND_SEEKPOINT,n)}}},{key:"_enableStatisticsReporter",value:function e(){if(this._statisticsReporter==null){this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)}}},{key:"_disableStatisticsReporter",value:function e(){if(this._statisticsReporter){self.clearInterval(this._statisticsReporter);this._statisticsReporter=null}}},{key:"_reportSegmentMediaInfo",value:function e(t){var r=this._mediaInfo.segments[t];var i=Object.assign({},r);i.duration=this._mediaInfo.duration;i.segmentCount=this._mediaInfo.segmentCount;delete i.segments;delete i.keyframesIndex;this._emitter.emit(b.default.MEDIA_INFO,i)}},{key:"_reportStatisticsInfo",value:function e(){var t={};t.url=this._ioctl.currentURL;t.hasRedirect=this._ioctl.hasRedirect;if(t.hasRedirect){t.redirectedURL=this._ioctl.currentRedirectedURL}t.speed=this._ioctl.currentSpeed;t.loaderType=this._ioctl.loaderType;t.currentSegmentIndex=this._currentSegmentIndex;t.totalSegmentCount=this._mediaDataSource.segments.length;this._emitter.emit(b.default.STATISTICS_INFO,t)}}]);return e}();r.default=w},{"../demux/demux-errors.js":16,"../demux/flv-demuxer.js":18,"../io/io-controller.js":23,"../io/loader.js":24,"../remux/mp4-remuxer.js":38,"../utils/browser.js":39,"../utils/logger.js":41,"./media-info.js":7,"./transmuxing-events.js":13,events:2}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};r.default=i},{}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("../utils/logger.js");var n=l(i);var a=e("../utils/logging-control.js");var p=l(a);var s=e("../utils/polyfill.js");var g=l(s);var o=e("./transmuxing-controller.js");var y=l(o);var u=e("./transmuxing-events.js");var E=l(u);function l(e){return e&&e.__esModule?e:{default:e}}var f=function e(i){var t="TransmuxingWorker";var r=null;var n=m.bind(this);g.default.install();i.addEventListener("message",function(e){switch(e.data.cmd){case"init":r=new y.default(e.data.param[0],e.data.param[1]);r.on(E.default.IO_ERROR,c.bind(this));r.on(E.default.DEMUX_ERROR,_.bind(this));r.on(E.default.INIT_SEGMENT,a.bind(this));r.on(E.default.MEDIA_SEGMENT,s.bind(this));r.on(E.default.LOADING_COMPLETE,o.bind(this));r.on(E.default.RECOVERED_EARLY_EOF,u.bind(this));r.on(E.default.MEDIA_INFO,l.bind(this));r.on(E.default.METADATA_ARRIVED,f.bind(this));r.on(E.default.SCRIPTDATA_ARRIVED,d.bind(this));r.on(E.default.STATISTICS_INFO,h.bind(this));r.on(E.default.RECOMMEND_SEEKPOINT,v.bind(this));break;case"destroy":if(r){r.destroy();r=null}i.postMessage({msg:"destroyed"});break;case"start":r.start();break;case"stop":r.stop();break;case"seek":r.seek(e.data.param);break;case"pause":r.pause();break;case"resume":r.resume();break;case"logging_config":{var t=e.data.param;p.default.applyConfig(t);if(t.enableCallback===true){p.default.addLogListener(n)}else{p.default.removeLogListener(n)}break}}});function a(e,t){var r={msg:E.default.INIT_SEGMENT,data:{type:e,data:t}};i.postMessage(r,[t.data])}function s(e,t){var r={msg:E.default.MEDIA_SEGMENT,data:{type:e,data:t}};i.postMessage(r,[t.data])}function o(){var e={msg:E.default.LOADING_COMPLETE};i.postMessage(e)}function u(){var e={msg:E.default.RECOVERED_EARLY_EOF};i.postMessage(e)}function l(e){var t={msg:E.default.MEDIA_INFO,data:e};i.postMessage(t)}function f(e){var t={msg:E.default.METADATA_ARRIVED,data:e};i.postMessage(t)}function d(e){var t={msg:E.default.SCRIPTDATA_ARRIVED,data:e};i.postMessage(t)}function h(e){var t={msg:E.default.STATISTICS_INFO,data:e};i.postMessage(t)}function c(e,t){i.postMessage({msg:E.default.IO_ERROR,data:{type:e,info:t}})}function _(e,t){i.postMessage({msg:E.default.DEMUX_ERROR,data:{type:e,info:t}})}function v(e){i.postMessage({msg:E.default.RECOMMEND_SEEKPOINT,data:e})}function m(e,t){i.postMessage({msg:"logcat_callback",data:{type:e,logcat:t}})}};r.default=f},{"../utils/logger.js":41,"../utils/logging-control.js":42,"../utils/polyfill.js":43,"./transmuxing-controller.js":12,"./transmuxing-events.js":13}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var n=e("../utils/logger.js");var k=s(n);var a=e("../utils/utf8-conv.js");var o=s(a);var L=e("../utils/exception.js");function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var w=function(){var e=new ArrayBuffer(2);new DataView(e).setInt16(0,256,true);return new Int16Array(e)[0]===256}();var l=function(){function S(){u(this,S)}i(S,null,[{key:"parseScriptData",value:function e(t,r,i){var n={};try{var a=S.parseValue(t,r,i);var s=S.parseValue(t,r+a.size,i-a.size);n[a.data]=s.data}catch(e){k.default.e("AMF",e.toString())}return n}},{key:"parseObject",value:function e(t,r,i){if(i<3){throw new L.IllegalStateException("Data not enough when parse ScriptDataObject")}var n=S.parseString(t,r,i);var a=S.parseValue(t,r+n.size,i-n.size);var s=a.objectEnd;return{data:{name:n.data,value:a.data},size:n.size+a.size,objectEnd:s}}},{key:"parseVariable",value:function e(t,r,i){return S.parseObject(t,r,i)}},{key:"parseString",value:function e(t,r,i){if(i<2){throw new L.IllegalStateException("Data not enough when parse String")}var n=new DataView(t,r,i);var a=n.getUint16(0,!w);var s=void 0;if(a>0){s=(0,o.default)(new Uint8Array(t,r+2,a))}else{s=""}return{data:s,size:2+a}}},{key:"parseLongString",value:function e(t,r,i){if(i<4){throw new L.IllegalStateException("Data not enough when parse LongString")}var n=new DataView(t,r,i);var a=n.getUint32(0,!w);var s=void 0;if(a>0){s=(0,o.default)(new Uint8Array(t,r+4,a))}else{s=""}return{data:s,size:4+a}}},{key:"parseDate",value:function e(t,r,i){if(i<10){throw new L.IllegalStateException("Data size invalid when parse Date")}var n=new DataView(t,r,i);var a=n.getFloat64(0,!w);var s=n.getInt16(8,!w);a+=s*60*1e3;return{data:new Date(a),size:8+2}}},{key:"parseValue",value:function e(t,r,i){if(i<1){throw new L.IllegalStateException("Data not enough when parse Value")}var n=new DataView(t,r,i);var a=1;var s=n.getUint8(0);var o=void 0;var u=false;try{switch(s){case 0:o=n.getFloat64(1,!w);a+=8;break;case 1:{var l=n.getUint8(1);o=l?true:false;a+=1;break}case 2:{var f=S.parseString(t,r+1,i-1);o=f.data;a+=f.size;break}case 3:{o={};var d=0;if((n.getUint32(i-4,!w)&16777215)===9){d=3}while(a<i-4){var h=S.parseObject(t,r+a,i-a-d);if(h.objectEnd)break;o[h.data.name]=h.data.value;a+=h.size}if(a<=i-3){var c=n.getUint32(a-1,!w)&16777215;if(c===9){a+=3}}break}case 8:{o={};a+=4;var _=0;if((n.getUint32(i-4,!w)&16777215)===9){_=3}while(a<i-8){var v=S.parseVariable(t,r+a,i-a-_);if(v.objectEnd)break;o[v.data.name]=v.data.value;a+=v.size}if(a<=i-3){var m=n.getUint32(a-1,!w)&16777215;if(m===9){a+=3}}break}case 9:o=undefined;a=1;u=true;break;case 10:{o=[];var p=n.getUint32(1,!w);a+=4;for(var g=0;g<p;g++){var y=S.parseValue(t,r+a,i-a);o.push(y.data);a+=y.size}break}case 11:{var E=S.parseDate(t,r+1,i-1);o=E.data;a+=E.size;break}case 12:{var b=S.parseString(t,r+1,i-1);o=b.data;a+=b.size;break}default:a=i;k.default.w("AMF","Unsupported AMF value type "+s)}}catch(e){k.default.e("AMF",e.toString())}return{data:o,size:a,objectEnd:u}}}]);return S}();r.default=l},{"../utils/exception.js":40,"../utils/logger.js":41,"../utils/utf8-conv.js":44}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};r.default=i},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var o=e("../utils/exception.js");function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function t(e){n(this,t);this.TAG="ExpGolomb";this._buffer=e;this._buffer_index=0;this._total_bytes=e.byteLength;this._total_bits=e.byteLength*8;this._current_word=0;this._current_word_bits_left=0}i(t,[{key:"destroy",value:function e(){this._buffer=null}},{key:"_fillCurrentWord",value:function e(){var t=this._total_bytes-this._buffer_index;if(t<=0)throw new o.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var r=Math.min(4,t);var i=new Uint8Array(4);i.set(this._buffer.subarray(this._buffer_index,this._buffer_index+r));this._current_word=new DataView(i.buffer).getUint32(0,false);this._buffer_index+=r;this._current_word_bits_left=r*8}},{key:"readBits",value:function e(t){if(t>32)throw new o.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(t<=this._current_word_bits_left){var r=this._current_word>>>32-t;this._current_word<<=t;this._current_word_bits_left-=t;return r}var i=this._current_word_bits_left?this._current_word:0;i=i>>>32-this._current_word_bits_left;var n=t-this._current_word_bits_left;this._fillCurrentWord();var a=Math.min(n,this._current_word_bits_left);var s=this._current_word>>>32-a;this._current_word<<=a;this._current_word_bits_left-=a;i=i<<a|s;return i}},{key:"readBool",value:function e(){return this.readBits(1)===1}},{key:"readByte",value:function e(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function e(){var t=void 0;for(t=0;t<this._current_word_bits_left;t++){if(0!==(this._current_word&2147483648>>>t)){this._current_word<<=t;this._current_word_bits_left-=t;return t}}this._fillCurrentWord();return t+this._skipLeadingZero()}},{key:"readUEG",value:function e(){var t=this._skipLeadingZero();return this.readBits(t+1)-1}},{key:"readSEG",value:function e(){var t=this.readUEG();if(t&1){return t+1>>>1}else{return-1*(t>>>1)}}}]);return t}();r.default=a},{"../utils/exception.js":40}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var f=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var n=e("../utils/logger.js");var T=h(n);var a=e("./amf-parser.js");var d=h(a);var s=e("./sps-parser.js");var O=h(s);var o=e("./demux-errors.js");var C=h(o);var u=e("../core/media-info.js");var l=h(u);var E=e("../utils/exception.js");function h(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _(e){return e>>>8&255|(e&255)<<8}function v(e){return(e&4278190080)>>>24|(e&16711680)>>>8|(e&65280)<<8|(e&255)<<24}function m(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}var p=function(){function y(e,t){c(this,y);this.TAG="FLVDemuxer";this._config=t;this._onError=null;this._onMediaInfo=null;this._onMetaDataArrived=null;this._onScriptDataArrived=null;this._onTrackMetadata=null;this._onDataAvailable=null;this._dataOffset=e.dataOffset;this._firstParse=true;this._dispatch=false;this._hasAudio=e.hasAudioTrack;this._hasVideo=e.hasVideoTrack;this._hasAudioFlagOverrided=false;this._hasVideoFlagOverrided=false;this._audioInitialMetadataDispatched=false;this._videoInitialMetadataDispatched=false;this._mediaInfo=new l.default;this._mediaInfo.hasAudio=this._hasAudio;this._mediaInfo.hasVideo=this._hasVideo;this._metadata=null;this._audioMetadata=null;this._videoMetadata=null;this._naluLengthSize=4;this._timestampBase=0;this._timescale=1e3;this._duration=0;this._durationOverrided=false;this._referenceFrameRate={fixed:true,fps:23.976,fps_num:23976,fps_den:1e3};this._flvSoundRateTable=[5500,11025,22050,44100,48e3];this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0];this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0];this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0];this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1];this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1];this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1];this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0};this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};this._littleEndian=function(){var e=new ArrayBuffer(2);new DataView(e).setInt16(0,256,true);return new Int16Array(e)[0]===256}()}i(y,[{key:"destroy",value:function e(){this._mediaInfo=null;this._metadata=null;this._audioMetadata=null;this._videoMetadata=null;this._videoTrack=null;this._audioTrack=null;this._onError=null;this._onMediaInfo=null;this._onMetaDataArrived=null;this._onScriptDataArrived=null;this._onTrackMetadata=null;this._onDataAvailable=null}},{key:"bindDataSource",value:function e(t){t.onDataArrival=this.parseChunks.bind(this);return this}},{key:"resetMediaInfo",value:function e(){this._mediaInfo=new l.default}},{key:"_isInitialMetadataDispatched",value:function e(){if(this._hasAudio&&this._hasVideo){return this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched}if(this._hasAudio&&!this._hasVideo){return this._audioInitialMetadataDispatched}if(!this._hasAudio&&this._hasVideo){return this._videoInitialMetadataDispatched}return false}},{key:"parseChunks",value:function e(t,r){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable){throw new E.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified")}var i=0;var n=this._littleEndian;if(r===0){if(t.byteLength>13){var a=y.probe(t);i=a.dataOffset}else{return 0}}if(this._firstParse){this._firstParse=false;if(r+i!==this._dataOffset){T.default.w(this.TAG,"First time parsing but chunk byteStart invalid!")}var s=new DataView(t,i);var o=s.getUint32(0,!n);if(o!==0){T.default.w(this.TAG,"PrevTagSize0 !== 0 !!!")}i+=4}while(i<t.byteLength){this._dispatch=true;var u=new DataView(t,i);if(i+11+4>t.byteLength){break}var l=u.getUint8(0);var f=u.getUint32(0,!n)&16777215;if(i+11+f+4>t.byteLength){break}if(l!==8&&l!==9&&l!==18){T.default.w(this.TAG,"Unsupported tag type "+l+", skipped");i+=11+f+4;continue}var d=u.getUint8(4);var h=u.getUint8(5);var c=u.getUint8(6);var _=u.getUint8(7);var v=c|h<<8|d<<16|_<<24;var m=u.getUint32(7,!n)&16777215;if(m!==0){T.default.w(this.TAG,"Meet tag which has StreamID != 0!")}var p=i+11;switch(l){case 8:this._parseAudioData(t,p,f,v);break;case 9:this._parseVideoData(t,p,f,v,r+i);break;case 18:this._parseScriptData(t,p,f);break}var g=u.getUint32(11+f,!n);if(g!==11+f){T.default.w(this.TAG,"Invalid PrevTagSize "+g)}i+=11+f+4}if(this._isInitialMetadataDispatched()){if(this._dispatch&&(this._audioTrack.length||this._videoTrack.length)){this._onDataAvailable(this._audioTrack,this._videoTrack)}}return i}},{key:"_parseScriptData",value:function e(t,r,i){var n=d.default.parseScriptData(t,r,i);if(n.hasOwnProperty("onMetaData")){if(n.onMetaData==null||f(n.onMetaData)!=="object"){T.default.w(this.TAG,"Invalid onMetaData structure!");return}if(this._metadata){T.default.w(this.TAG,"Found another onMetaData tag!")}this._metadata=n;var a=this._metadata.onMetaData;if(this._onMetaDataArrived){this._onMetaDataArrived(Object.assign({},a))}if(typeof a.hasAudio==="boolean"){if(this._hasAudioFlagOverrided===false){this._hasAudio=a.hasAudio;this._mediaInfo.hasAudio=this._hasAudio}}if(typeof a.hasVideo==="boolean"){if(this._hasVideoFlagOverrided===false){this._hasVideo=a.hasVideo;this._mediaInfo.hasVideo=this._hasVideo}}if(typeof a.audiodatarate==="number"){this._mediaInfo.audioDataRate=a.audiodatarate}if(typeof a.videodatarate==="number"){this._mediaInfo.videoDataRate=a.videodatarate}if(typeof a.width==="number"){this._mediaInfo.width=a.width}if(typeof a.height==="number"){this._mediaInfo.height=a.height}if(typeof a.duration==="number"){if(!this._durationOverrided){var s=Math.floor(a.duration*this._timescale);this._duration=s;this._mediaInfo.duration=s}}else{this._mediaInfo.duration=0}if(typeof a.framerate==="number"){var o=Math.floor(a.framerate*1e3);if(o>0){var u=o/1e3;this._referenceFrameRate.fixed=true;this._referenceFrameRate.fps=u;this._referenceFrameRate.fps_num=o;this._referenceFrameRate.fps_den=1e3;this._mediaInfo.fps=u}}if(f(a.keyframes)==="object"){this._mediaInfo.hasKeyframesIndex=true;var l=a.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(l);a.keyframes=null}else{this._mediaInfo.hasKeyframesIndex=false}this._dispatch=false;this._mediaInfo.metadata=a;T.default.v(this.TAG,"Parsed onMetaData");if(this._mediaInfo.isComplete()){this._onMediaInfo(this._mediaInfo)}}if(Object.keys(n).length>0){if(this._onScriptDataArrived){this._onScriptDataArrived(Object.assign({},n))}}}},{key:"_parseKeyframesIndex",value:function e(t){var r=[];var i=[];for(var n=1;n<t.times.length;n++){var a=this._timestampBase+Math.floor(t.times[n]*1e3);r.push(a);i.push(t.filepositions[n])}return{times:r,filepositions:i}}},{key:"_parseAudioData",value:function e(t,r,i,n){if(i<=1){T.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(this._hasAudioFlagOverrided===true&&this._hasAudio===false){return}var a=this._littleEndian;var s=new DataView(t,r,i);var o=s.getUint8(0);var u=o>>>4;if(u!==2&&u!==10){this._onError(C.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+u);return}var l=0;var f=(o&12)>>>2;if(f>=0&&f<=4){l=this._flvSoundRateTable[f]}else{this._onError(C.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+f);return}var d=(o&2)>>>1;var h=o&1;var c=this._audioMetadata;var _=this._audioTrack;if(!c){if(this._hasAudio===false&&this._hasAudioFlagOverrided===false){this._hasAudio=true;this._mediaInfo.hasAudio=true}c=this._audioMetadata={};c.type="audio";c.id=_.id;c.timescale=this._timescale;c.duration=this._duration;c.audioSampleRate=l;c.channelCount=h===0?1:2}if(u===10){var v=this._parseAACAudioData(t,r+1,i-1);if(v==undefined){return}if(v.packetType===0){if(c.config){T.default.w(this.TAG,"Found another AudioSpecificConfig!")}var m=v.data;c.audioSampleRate=m.samplingRate;c.channelCount=m.channelCount;c.codec=m.codec;c.originalCodec=m.originalCodec;c.config=m.config;c.refSampleDuration=1024/c.audioSampleRate*c.timescale;T.default.v(this.TAG,"Parsed AudioSpecificConfig");if(this._isInitialMetadataDispatched()){if(this._dispatch&&(this._audioTrack.length||this._videoTrack.length)){this._onDataAvailable(this._audioTrack,this._videoTrack)}}else{this._audioInitialMetadataDispatched=true}this._dispatch=false;this._onTrackMetadata("audio",c);var p=this._mediaInfo;p.audioCodec=c.originalCodec;p.audioSampleRate=c.audioSampleRate;p.audioChannelCount=c.channelCount;if(p.hasVideo){if(p.videoCodec!=null){p.mimeType='video/x-flv; codecs="'+p.videoCodec+","+p.audioCodec+'"'}}else{p.mimeType='video/x-flv; codecs="'+p.audioCodec+'"'}if(p.isComplete()){this._onMediaInfo(p)}}else if(v.packetType===1){var g=this._timestampBase+n;var y={unit:v.data,length:v.data.byteLength,dts:g,pts:g};_.samples.push(y);_.length+=v.data.length}else{T.default.e(this.TAG,"Flv: Unsupported AAC data type "+v.packetType)}}else if(u===2){if(!c.codec){var E=this._parseMP3AudioData(t,r+1,i-1,true);if(E==undefined){return}c.audioSampleRate=E.samplingRate;c.channelCount=E.channelCount;c.codec=E.codec;c.originalCodec=E.originalCodec;c.refSampleDuration=1152/c.audioSampleRate*c.timescale;T.default.v(this.TAG,"Parsed MPEG Audio Frame Header");this._audioInitialMetadataDispatched=true;this._onTrackMetadata("audio",c);var b=this._mediaInfo;b.audioCodec=c.codec;b.audioSampleRate=c.audioSampleRate;b.audioChannelCount=c.channelCount;b.audioDataRate=E.bitRate;if(b.hasVideo){if(b.videoCodec!=null){b.mimeType='video/x-flv; codecs="'+b.videoCodec+","+b.audioCodec+'"'}}else{b.mimeType='video/x-flv; codecs="'+b.audioCodec+'"'}if(b.isComplete()){this._onMediaInfo(b)}}var S=this._parseMP3AudioData(t,r+1,i-1,false);if(S==undefined){return}var k=this._timestampBase+n;var L={unit:S,length:S.byteLength,dts:k,pts:k};_.samples.push(L);_.length+=S.length}}},{key:"_parseAACAudioData",value:function e(t,r,i){if(i<=1){T.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var n={};var a=new Uint8Array(t,r,i);n.packetType=a[0];if(a[0]===0){n.data=this._parseAACAudioSpecificConfig(t,r+1,i-1)}else{n.data=a.subarray(1)}return n}},{key:"_parseAACAudioSpecificConfig",value:function e(t,r,i){var n=new Uint8Array(t,r,i);var a=null;var s=0;var o=0;var u=null;var l=0;var f=null;s=o=n[0]>>>3;l=(n[0]&7)<<1|n[1]>>>7;if(l<0||l>=this._mpegSamplingRates.length){this._onError(C.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var d=this._mpegSamplingRates[l];var h=(n[1]&120)>>>3;if(h<0||h>=8){this._onError(C.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}if(s===5){f=(n[1]&7)<<1|n[2]>>>7;u=(n[2]&124)>>>2}var c=self.navigator.userAgent.toLowerCase();if(c.indexOf("firefox")!==-1){if(l>=6){s=5;a=new Array(4);f=l-3}else{s=2;a=new Array(2);f=l}}else if(c.indexOf("android")!==-1){s=2;a=new Array(2);f=l}else{s=5;f=l;a=new Array(4);if(l>=6){f=l-3}else if(h===1){s=2;a=new Array(2);f=l}}a[0]=s<<3;a[0]|=(l&15)>>>1;a[1]=(l&15)<<7;a[1]|=(h&15)<<3;if(s===5){a[1]|=(f&15)>>>1;a[2]=(f&1)<<7;a[2]|=2<<2;a[3]=0}return{config:a,samplingRate:d,channelCount:h,codec:"mp4a.40."+s,originalCodec:"mp4a.40."+o}}},{key:"_parseMP3AudioData",value:function e(t,r,i,n){if(i<4){T.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}var a=this._littleEndian;var s=new Uint8Array(t,r,i);var o=null;if(n){if(s[0]!==255){return}var u=s[1]>>>3&3;var l=(s[1]&6)>>1;var f=(s[2]&240)>>>4;var d=(s[2]&12)>>>2;var h=s[3]>>>6&3;var c=h!==3?2:1;var _=0;var v=0;var m=34;var p="mp3";switch(u){case 0:_=this._mpegAudioV25SampleRateTable[d];break;case 2:_=this._mpegAudioV20SampleRateTable[d];break;case 3:_=this._mpegAudioV10SampleRateTable[d];break}switch(l){case 1:m=34;if(f<this._mpegAudioL3BitRateTable.length){v=this._mpegAudioL3BitRateTable[f]}break;case 2:m=33;if(f<this._mpegAudioL2BitRateTable.length){v=this._mpegAudioL2BitRateTable[f]}break;case 3:m=32;if(f<this._mpegAudioL1BitRateTable.length){v=this._mpegAudioL1BitRateTable[f]}break}o={bitRate:v,samplingRate:_,channelCount:c,codec:p,originalCodec:p}}else{o=s}return o}},{key:"_parseVideoData",value:function e(t,r,i,n,a){if(i<=1){T.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(this._hasVideoFlagOverrided===true&&this._hasVideo===false){return}var s=new Uint8Array(t,r,i)[0];var o=(s&240)>>>4;var u=s&15;if(u!==7){this._onError(C.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+u);return}this._parseAVCVideoPacket(t,r+1,i-1,n,a,o)}},{key:"_parseAVCVideoPacket",value:function e(t,r,i,n,a,s){if(i<4){T.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var o=this._littleEndian;var u=new DataView(t,r,i);var l=u.getUint8(0);var f=u.getUint32(0,!o)&16777215;var d=f<<8>>8;if(l===0){this._parseAVCDecoderConfigurationRecord(t,r+4,i-4)}else if(l===1){this._parseAVCVideoData(t,r+4,i-4,n,a,s,d)}else if(l===2){}else{this._onError(C.default.FORMAT_ERROR,"Flv: Invalid video packet type "+l);return}}},{key:"_parseAVCDecoderConfigurationRecord",value:function e(t,r,i){if(i<7){T.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var n=this._videoMetadata;var a=this._videoTrack;var s=this._littleEndian;var o=new DataView(t,r,i);if(!n){if(this._hasVideo===false&&this._hasVideoFlagOverrided===false){this._hasVideo=true;this._mediaInfo.hasVideo=true}n=this._videoMetadata={};n.type="video";n.id=a.id;n.timescale=this._timescale;n.duration=this._duration}else{if(typeof n.avcc!=="undefined"){T.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!")}}var u=o.getUint8(0);var l=o.getUint8(1);var f=o.getUint8(2);var d=o.getUint8(3);if(u!==1||l===0){this._onError(C.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}this._naluLengthSize=(o.getUint8(4)&3)+1;if(this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(C.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var h=o.getUint8(5)&31;if(h===0){this._onError(C.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else if(h>1){T.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+h)}var c=6;for(var _=0;_<h;_++){var v=o.getUint16(c,!s);c+=2;if(v===0){continue}var m=new Uint8Array(t,r+c,v);c+=v;var p=O.default.parseSPS(m);if(_!==0){continue}n.codecWidth=p.codec_size.width;n.codecHeight=p.codec_size.height;n.presentWidth=p.present_size.width;n.presentHeight=p.present_size.height;n.profile=p.profile_string;n.level=p.level_string;n.bitDepth=p.bit_depth;n.chromaFormat=p.chroma_format;n.sarRatio=p.sar_ratio;n.frameRate=p.frame_rate;if(p.frame_rate.fixed===false||p.frame_rate.fps_num===0||p.frame_rate.fps_den===0){n.frameRate=this._referenceFrameRate}var g=n.frameRate.fps_den;var y=n.frameRate.fps_num;n.refSampleDuration=n.timescale*(g/y);var E=m.subarray(1,4);var b="avc1.";for(var S=0;S<3;S++){var k=E[S].toString(16);if(k.length<2){k="0"+k}b+=k}n.codec=b;var L=this._mediaInfo;L.width=n.codecWidth;L.height=n.codecHeight;L.fps=n.frameRate.fps;L.profile=n.profile;L.level=n.level;L.refFrames=p.ref_frames;L.chromaFormat=p.chroma_format_string;L.sarNum=n.sarRatio.width;L.sarDen=n.sarRatio.height;L.videoCodec=b;if(L.hasAudio){if(L.audioCodec!=null){L.mimeType='video/x-flv; codecs="'+L.videoCodec+","+L.audioCodec+'"'}}else{L.mimeType='video/x-flv; codecs="'+L.videoCodec+'"'}if(L.isComplete()){this._onMediaInfo(L)}}var w=o.getUint8(c);if(w===0){this._onError(C.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else if(w>1){T.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+w)}c++;for(var R=0;R<w;R++){var A=o.getUint16(c,!s);c+=2;if(A===0){continue}c+=A}n.avcc=new Uint8Array(i);n.avcc.set(new Uint8Array(t,r,i),0);T.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord");if(this._isInitialMetadataDispatched()){if(this._dispatch&&(this._audioTrack.length||this._videoTrack.length)){this._onDataAvailable(this._audioTrack,this._videoTrack)}}else{this._videoInitialMetadataDispatched=true}this._dispatch=false;this._onTrackMetadata("video",n)}},{key:"_parseAVCVideoData",value:function e(t,r,i,n,a,s,o){var u=this._littleEndian;var l=new DataView(t,r,i);var f=[],d=0;var h=0;var c=this._naluLengthSize;var _=this._timestampBase+n;var v=s===1;while(h<i){if(h+4>=i){T.default.w(this.TAG,"Malformed Nalu near timestamp "+_+", offset = "+h+", dataSize = "+i);break}var m=l.getUint32(h,!u);if(c===3){m>>>=8}if(m>i-c){T.default.w(this.TAG,"Malformed Nalus near timestamp "+_+", NaluSize > DataSize!");return}var p=l.getUint8(h+c)&31;if(p===5){v=true}var g=new Uint8Array(t,r+h,c+m);var y={type:p,data:g};f.push(y);d+=g.byteLength;h+=c+m}if(f.length){var E=this._videoTrack;var b={units:f,length:d,isKeyframe:v,dts:_,cts:o,pts:_+o};if(v){b.fileposition=a}E.samples.push(b);E.length+=d}}},{key:"onTrackMetadata",get:function e(){return this._onTrackMetadata},set:function e(t){this._onTrackMetadata=t}},{key:"onMediaInfo",get:function e(){return this._onMediaInfo},set:function e(t){this._onMediaInfo=t}},{key:"onMetaDataArrived",get:function e(){return this._onMetaDataArrived},set:function e(t){this._onMetaDataArrived=t}},{key:"onScriptDataArrived",get:function e(){return this._onScriptDataArrived},set:function e(t){this._onScriptDataArrived=t}},{key:"onError",get:function e(){return this._onError},set:function e(t){this._onError=t}},{key:"onDataAvailable",get:function e(){return this._onDataAvailable},set:function e(t){this._onDataAvailable=t}},{key:"timestampBase",get:function e(){return this._timestampBase},set:function e(t){this._timestampBase=t}},{key:"overridedDuration",get:function e(){return this._duration},set:function e(t){this._durationOverrided=true;this._duration=t;this._mediaInfo.duration=t}},{key:"overridedHasAudio",set:function e(t){this._hasAudioFlagOverrided=true;this._hasAudio=t;this._mediaInfo.hasAudio=t}},{key:"overridedHasVideo",set:function e(t){this._hasVideoFlagOverrided=true;this._hasVideo=t;this._mediaInfo.hasVideo=t}}],[{key:"probe",value:function e(t){var r=new Uint8Array(t);var i={match:false};if(r[0]!==70||r[1]!==76||r[2]!==86||r[3]!==1){return i}var n=(r[4]&4)>>>2!==0;var a=(r[4]&1)!==0;var s=m(r,5);if(s<9){return i}return{match:true,consumed:s,dataOffset:s,hasAudioTrack:n,hasVideoTrack:a}}}]);return y}();r.default=p},{"../core/media-info.js":7,"../utils/exception.js":40,"../utils/logger.js":41,"./amf-parser.js":15,"./demux-errors.js":16,"./sps-parser.js":19}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var n=e("./exp-golomb.js");var W=a(n);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function q(){s(this,q)}i(q,null,[{key:"_ebsp2rbsp",value:function e(t){var r=t;var i=r.byteLength;var n=new Uint8Array(i);var a=0;for(var s=0;s<i;s++){if(s>=2){if(r[s]===3&&r[s-1]===0&&r[s-2]===0){continue}}n[a]=r[s];a++}return new Uint8Array(n.buffer,0,a)}},{key:"parseSPS",value:function e(t){var r=q._ebsp2rbsp(t);var i=new W.default(r);i.readByte();var n=i.readByte();i.readByte();var a=i.readByte();i.readUEG();var s=q.getProfileString(n);var o=q.getLevelString(a);var u=1;var l=420;var f=[0,420,422,444];var d=8;if(n===100||n===110||n===122||n===244||n===44||n===83||n===86||n===118||n===128||n===138||n===144){u=i.readUEG();if(u===3){i.readBits(1)}if(u<=3){l=f[u]}d=i.readUEG()+8;i.readUEG();i.readBits(1);if(i.readBool()){var h=u!==3?8:12;for(var c=0;c<h;c++){if(i.readBool()){if(c<6){q._skipScalingList(i,16)}else{q._skipScalingList(i,64)}}}}}i.readUEG();var _=i.readUEG();if(_===0){i.readUEG()}else if(_===1){i.readBits(1);i.readSEG();i.readSEG();var v=i.readUEG();for(var m=0;m<v;m++){i.readSEG()}}var p=i.readUEG();i.readBits(1);var g=i.readUEG();var y=i.readUEG();var E=i.readBits(1);if(E===0){i.readBits(1)}i.readBits(1);var b=0;var S=0;var k=0;var L=0;var w=i.readBool();if(w){b=i.readUEG();S=i.readUEG();k=i.readUEG();L=i.readUEG()}var R=1,A=1;var T=0,O=true,C=0,I=0;var D=i.readBool();if(D){if(i.readBool()){var x=i.readByte();var M=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2];var B=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];if(x>0&&x<16){R=M[x-1];A=B[x-1]}else if(x===255){R=i.readByte()<<8|i.readByte();A=i.readByte()<<8|i.readByte()}}if(i.readBool()){i.readBool()}if(i.readBool()){i.readBits(4);if(i.readBool()){i.readBits(24)}}if(i.readBool()){i.readUEG();i.readUEG()}if(i.readBool()){var j=i.readBits(32);var P=i.readBits(32);O=i.readBool();C=P;I=j*2;T=C/I}}var U=1;if(R!==1||A!==1){U=R/A}var N=0,F=0;if(u===0){N=1;F=2-E}else{var G=u===3?1:2;var V=u===1?2:1;N=G;F=V*(2-E)}var z=(g+1)*16;var H=(2-E)*((y+1)*16);z-=(b+S)*N;H-=(k+L)*F;var K=Math.ceil(z*U);i.destroy();i=null;return{profile_string:s,level_string:o,bit_depth:d,ref_frames:p,chroma_format:l,chroma_format_string:q.getChromaFormatString(l),frame_rate:{fixed:O,fps:T,fps_den:I,fps_num:C},sar_ratio:{width:R,height:A},codec_size:{width:z,height:H},present_size:{width:K,height:H}}}},{key:"_skipScalingList",value:function e(t,r){var i=8,n=8;var a=0;for(var s=0;s<r;s++){if(n!==0){a=t.readSEG();n=(i+a+256)%256}i=n===0?i:n}}},{key:"getProfileString",value:function e(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function e(t){return(t/10).toFixed(1)}},{key:"getChromaFormatString",value:function e(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]);return q}();r.default=o},{"./exp-golomb.js":17}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=e("./utils/polyfill.js");var a=y(n);var s=e("./core/features.js");var o=y(s);var u=e("./io/loader.js");var l=e("./player/flv-player.js");var f=y(l);var d=e("./player/native-player.js");var h=y(d);var c=e("./player/player-events.js");var _=y(c);var v=e("./player/player-errors.js");var m=e("./utils/logging-control.js");var p=y(m);var g=e("./utils/exception.js");function y(e){return e&&e.__esModule?e:{default:e}}a.default.install();function E(e,t){var r=e;if(r==null||(typeof r==="undefined"?"undefined":i(r))!=="object"){throw new g.InvalidArgumentException("MediaDataSource must be an javascript object!")}if(!r.hasOwnProperty("type")){throw new g.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!")}switch(r.type){case"flv":return new f.default(r,t);default:return new h.default(r,t)}}function b(){return o.default.supportMSEH264Playback()}function S(){return o.default.getFeatureList()}var k={};k.createPlayer=E;k.isSupported=b;k.getFeatureList=S;k.BaseLoader=u.BaseLoader;k.LoaderStatus=u.LoaderStatus;k.LoaderErrors=u.LoaderErrors;k.Events=_.default;k.ErrorTypes=v.ErrorTypes;k.ErrorDetails=v.ErrorDetails;k.FlvPlayer=f.default;k.NativePlayer=h.default;k.LoggingControl=p.default;Object.defineProperty(k,"version",{enumerable:true,get:function e(){return"1.5.0"}});r.default=k},{"./core/features.js":6,"./io/loader.js":24,"./player/flv-player.js":32,"./player/native-player.js":33,"./player/player-errors.js":34,"./player/player-events.js":35,"./utils/exception.js":40,"./utils/logging-control.js":42,"./utils/polyfill.js":43}],21:[function(e,t,r){"use strict";t.exports=e("./flv.js").default},{"./flv.js":20}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var d=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function e(t,r,i){if(t===null)t=Function.prototype;var n=Object.getOwnPropertyDescriptor(t,r);if(n===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,r,i)}}else if("value"in n){return n.value}else{var s=n.get;if(s===undefined){return undefined}return s.call(i)}};var a=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var i=e("../utils/logger.js");var s=l(i);var o=e("../utils/browser.js");var u=l(o);var h=e("./loader.js");var c=e("../utils/exception.js");function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function v(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var m=function(e){v(i,e);a(i,null,[{key:"isSupported",value:function e(){try{var t=u.default.msedge&&u.default.version.minor>=15048;var r=u.default.msedge?t:true;return self.fetch&&self.ReadableStream&&r}catch(e){return false}}}]);function i(e,t){f(this,i);var r=_(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"fetch-stream-loader"));r.TAG="FetchStreamLoader";r._seekHandler=e;r._config=t;r._needStash=true;r._requestAbort=false;r._contentLength=null;r._receivedLength=0;return r}a(i,[{key:"destroy",value:function e(){if(this.isWorking()){this.abort()}n(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}},{key:"open",value:function e(t,r){var i=this;this._dataSource=t;this._range=r;var n=t.url;if(this._config.reuseRedirectedURL&&t.redirectedURL!=undefined){n=t.redirectedURL}var a=this._seekHandler.getConfig(n,r);var s=new self.Headers;if(d(a.headers)==="object"){var o=a.headers;for(var u in o){if(o.hasOwnProperty(u)){s.append(u,o[u])}}}var l={method:"GET",headers:s,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(d(this._config.headers)==="object"){for(var f in this._config.headers){s.append(f,this._config.headers[f])}}if(t.cors===false){l.mode="same-origin"}if(t.withCredentials){l.credentials="include"}if(t.referrerPolicy){l.referrerPolicy=t.referrerPolicy}this._status=h.LoaderStatus.kConnecting;self.fetch(a.url,l).then(function(e){if(i._requestAbort){i._requestAbort=false;i._status=h.LoaderStatus.kIdle;return}if(e.ok&&e.status>=200&&e.status<=299){if(e.url!==a.url){if(i._onURLRedirect){var t=i._seekHandler.removeURLParameters(e.url);i._onURLRedirect(t)}}var r=e.headers.get("Content-Length");if(r!=null){i._contentLength=parseInt(r);if(i._contentLength!==0){if(i._onContentLengthKnown){i._onContentLengthKnown(i._contentLength)}}}return i._pump.call(i,e.body.getReader())}else{i._status=h.LoaderStatus.kError;if(i._onError){i._onError(h.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})}else{throw new c.RuntimeException("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText)}}}).catch(function(e){i._status=h.LoaderStatus.kError;if(i._onError){i._onError(h.LoaderErrors.EXCEPTION,{code:-1,msg:e.message})}else{throw e}})}},{key:"abort",value:function e(){this._requestAbort=true}},{key:"_pump",value:function e(a){var s=this;return a.read().then(function(e){if(e.done){if(s._contentLength!==null&&s._receivedLength<s._contentLength){s._status=h.LoaderStatus.kError;var t=h.LoaderErrors.EARLY_EOF;var r={code:-1,msg:"Fetch stream meet Early-EOF"};if(s._onError){s._onError(t,r)}else{throw new c.RuntimeException(r.msg)}}else{s._status=h.LoaderStatus.kComplete;if(s._onComplete){s._onComplete(s._range.from,s._range.from+s._receivedLength-1)}}}else{if(s._requestAbort===true){s._requestAbort=false;s._status=h.LoaderStatus.kComplete;return a.cancel()}s._status=h.LoaderStatus.kBuffering;var i=e.value.buffer;var n=s._range.from+s._receivedLength;s._receivedLength+=i.byteLength;if(s._onDataArrival){s._onDataArrival(i,n,s._receivedLength)}s._pump(a)}}).catch(function(e){if(e.code===11&&u.default.msedge){return}s._status=h.LoaderStatus.kError;var t=0;var r=null;if((e.code===19||e.message==="network error")&&(s._contentLength===null||s._contentLength!==null&&s._receivedLength<s._contentLength)){t=h.LoaderErrors.EARLY_EOF;r={code:e.code,msg:"Fetch stream meet Early-EOF"}}else{t=h.LoaderErrors.EXCEPTION;r={code:e.code,msg:e.message}}if(s._onError){s._onError(t,r)}else{throw new c.RuntimeException(r.msg)}})}}]);return i}(h.BaseLoader);r.default=m},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var i=e("../utils/logger.js");var o=L(i);var a=e("./speed-sampler.js");var s=L(a);var u=e("./loader.js");var l=e("./fetch-stream-loader.js");var f=L(l);var d=e("./xhr-moz-chunked-loader.js");var h=L(d);var c=e("./xhr-msstream-loader.js");var _=L(c);var v=e("./xhr-range-loader.js");var m=L(v);var p=e("./websocket-loader.js");var g=L(p);var y=e("./range-seek-handler.js");var E=L(y);var b=e("./param-seek-handler.js");var S=L(b);var k=e("../utils/exception.js");function L(e){return e&&e.__esModule?e:{default:e}}function w(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var R=function(){function i(e,t,r){w(this,i);this.TAG="IOController";this._config=t;this._extraData=r;this._stashInitialSize=1024*384;if(t.stashInitialSize!=undefined&&t.stashInitialSize>0){this._stashInitialSize=t.stashInitialSize}this._stashUsed=0;this._stashSize=this._stashInitialSize;this._bufferSize=1024*1024*3;this._stashBuffer=new ArrayBuffer(this._bufferSize);this._stashByteStart=0;this._enableStash=true;if(t.enableStashBuffer===false){this._enableStash=false}this._loader=null;this._loaderClass=null;this._seekHandler=null;this._dataSource=e;this._isWebSocketURL=/wss?:\/\/(.+?)/.test(e.url);this._refTotalLength=e.filesize?e.filesize:null;this._totalLength=this._refTotalLength;this._fullRequestFlag=false;this._currentRange=null;this._redirectedURL=null;this._speedNormalized=0;this._speedSampler=new s.default;this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096];this._isEarlyEofReconnecting=false;this._paused=false;this._resumeFrom=0;this._onDataArrival=null;this._onSeeked=null;this._onError=null;this._onComplete=null;this._onRedirect=null;this._onRecoveredEarlyEof=null;this._selectSeekHandler();this._selectLoader();this._createLoader()}n(i,[{key:"destroy",value:function e(){if(this._loader.isWorking()){this._loader.abort()}this._loader.destroy();this._loader=null;this._loaderClass=null;this._dataSource=null;this._stashBuffer=null;this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0;this._currentRange=null;this._speedSampler=null;this._isEarlyEofReconnecting=false;this._onDataArrival=null;this._onSeeked=null;this._onError=null;this._onComplete=null;this._onRedirect=null;this._onRecoveredEarlyEof=null;this._extraData=null}},{key:"isWorking",value:function e(){return this._loader&&this._loader.isWorking()&&!this._paused}},{key:"isPaused",value:function e(){return this._paused}},{key:"_selectSeekHandler",value:function e(){var t=this._config;if(t.seekType==="range"){this._seekHandler=new E.default(this._config.rangeLoadZeroStart)}else if(t.seekType==="param"){var r=t.seekParamStart||"bstart";var i=t.seekParamEnd||"bend";this._seekHandler=new S.default(r,i)}else if(t.seekType==="custom"){if(typeof t.customSeekHandler!=="function"){throw new k.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!")}this._seekHandler=new t.customSeekHandler}else{throw new k.InvalidArgumentException("Invalid seekType in config: "+t.seekType)}}},{key:"_selectLoader",value:function e(){if(this._config.customLoader!=null){this._loaderClass=this._config.customLoader}else if(this._isWebSocketURL){this._loaderClass=g.default}else if(f.default.isSupported()){this._loaderClass=f.default}else if(h.default.isSupported()){this._loaderClass=h.default}else if(m.default.isSupported()){this._loaderClass=m.default}else{throw new k.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")}}},{key:"_createLoader",value:function e(){this._loader=new this._loaderClass(this._seekHandler,this._config);if(this._loader.needStashBuffer===false){this._enableStash=false}this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this);this._loader.onURLRedirect=this._onURLRedirect.bind(this);this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this);this._loader.onComplete=this._onLoaderComplete.bind(this);this._loader.onError=this._onLoaderError.bind(this)}},{key:"open",value:function e(t){this._currentRange={from:0,to:-1};if(t){this._currentRange.from=t}this._speedSampler.reset();if(!t){this._fullRequestFlag=true}this._loader.open(this._dataSource,Object.assign({},this._currentRange))}},{key:"abort",value:function e(){this._loader.abort();if(this._paused){this._paused=false;this._resumeFrom=0}}},{key:"pause",value:function e(){if(this.isWorking()){this._loader.abort();if(this._stashUsed!==0){this._resumeFrom=this._stashByteStart;this._currentRange.to=this._stashByteStart-1}else{this._resumeFrom=this._currentRange.to+1}this._stashUsed=0;this._stashByteStart=0;this._paused=true}}},{key:"resume",value:function e(){if(this._paused){this._paused=false;var t=this._resumeFrom;this._resumeFrom=0;this._internalSeek(t,true)}}},{key:"seek",value:function e(t){this._paused=false;this._stashUsed=0;this._stashByteStart=0;this._internalSeek(t,true)}},{key:"_internalSeek",value:function e(t,r){if(this._loader.isWorking()){this._loader.abort()}this._flushStashBuffer(r);this._loader.destroy();this._loader=null;var i={from:t,to:-1};this._currentRange={from:i.from,to:-1};this._speedSampler.reset();this._stashSize=this._stashInitialSize;this._createLoader();this._loader.open(this._dataSource,i);if(this._onSeeked){this._onSeeked()}}},{key:"updateUrl",value:function e(t){if(!t||typeof t!=="string"||t.length===0){throw new k.InvalidArgumentException("Url must be a non-empty string!")}this._dataSource.url=t}},{key:"_expandBuffer",value:function e(t){var r=this._stashSize;while(r+1024*1024*1<t){r*=2}r+=1024*1024*1;if(r===this._bufferSize){return}var i=new ArrayBuffer(r);if(this._stashUsed>0){var n=new Uint8Array(this._stashBuffer,0,this._stashUsed);var a=new Uint8Array(i,0,r);a.set(n,0)}this._stashBuffer=i;this._bufferSize=r}},{key:"_normalizeSpeed",value:function e(t){var r=this._speedNormalizeList;var i=r.length-1;var n=0;var a=0;var s=i;if(t<r[0]){return r[0]}while(a<=s){n=a+Math.floor((s-a)/2);if(n===i||t>=r[n]&&t<r[n+1]){return r[n]}else if(r[n]<t){a=n+1}else{s=n-1}}}},{key:"_adjustStashSize",value:function e(t){var r=0;if(this._config.isLive){r=t}else{if(t<512){r=t}else if(t>=512&&t<=1024){r=Math.floor(t*1.5)}else{r=t*2}}if(r>8192){r=8192}var i=r*1024+1024*1024*1;if(this._bufferSize<i){this._expandBuffer(i)}this._stashSize=r*1024}},{key:"_dispatchChunks",value:function e(t,r){this._currentRange.to=r+t.byteLength-1;return this._onDataArrival(t,r)}},{key:"_onURLRedirect",value:function e(t){this._redirectedURL=t;if(this._onRedirect){this._onRedirect(t)}}},{key:"_onContentLengthKnown",value:function e(t){if(t&&this._fullRequestFlag){this._totalLength=t;this._fullRequestFlag=false}}},{key:"_onLoaderChunkArrival",value:function e(t,r,i){if(!this._onDataArrival){throw new k.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!")}if(this._paused){return}if(this._isEarlyEofReconnecting){this._isEarlyEofReconnecting=false;if(this._onRecoveredEarlyEof){this._onRecoveredEarlyEof()}}this._speedSampler.addBytes(t.byteLength);var n=this._speedSampler.lastSecondKBps;if(n!==0){var a=this._normalizeSpeed(n);if(this._speedNormalized!==a){this._speedNormalized=a;this._adjustStashSize(a)}}if(!this._enableStash){if(this._stashUsed===0){var s=this._dispatchChunks(t,r);if(s<t.byteLength){var o=t.byteLength-s;if(o>this._bufferSize){this._expandBuffer(o)}var u=new Uint8Array(this._stashBuffer,0,this._bufferSize);u.set(new Uint8Array(t,s),0);this._stashUsed+=o;this._stashByteStart=r+s}}else{if(this._stashUsed+t.byteLength>this._bufferSize){this._expandBuffer(this._stashUsed+t.byteLength)}var l=new Uint8Array(this._stashBuffer,0,this._bufferSize);l.set(new Uint8Array(t),this._stashUsed);this._stashUsed+=t.byteLength;var f=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(f<this._stashUsed&&f>0){var d=new Uint8Array(this._stashBuffer,f);l.set(d,0)}this._stashUsed-=f;this._stashByteStart+=f}}else{if(this._stashUsed===0&&this._stashByteStart===0){this._stashByteStart=r}if(this._stashUsed+t.byteLength<=this._stashSize){var h=new Uint8Array(this._stashBuffer,0,this._stashSize);h.set(new Uint8Array(t),this._stashUsed);this._stashUsed+=t.byteLength}else{var c=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var _=this._stashBuffer.slice(0,this._stashUsed);var v=this._dispatchChunks(_,this._stashByteStart);if(v<_.byteLength){if(v>0){var m=new Uint8Array(_,v);c.set(m,0);this._stashUsed=m.byteLength;this._stashByteStart+=v}}else{this._stashUsed=0;this._stashByteStart+=v}if(this._stashUsed+t.byteLength>this._bufferSize){this._expandBuffer(this._stashUsed+t.byteLength);c=new Uint8Array(this._stashBuffer,0,this._bufferSize)}c.set(new Uint8Array(t),this._stashUsed);this._stashUsed+=t.byteLength}else{var p=this._dispatchChunks(t,r);if(p<t.byteLength){var g=t.byteLength-p;if(g>this._bufferSize){this._expandBuffer(g);c=new Uint8Array(this._stashBuffer,0,this._bufferSize)}c.set(new Uint8Array(t,p),0);this._stashUsed+=g;this._stashByteStart=r+p}}}}}},{key:"_flushStashBuffer",value:function e(t){if(this._stashUsed>0){var r=this._stashBuffer.slice(0,this._stashUsed);var i=this._dispatchChunks(r,this._stashByteStart);var n=r.byteLength-i;if(i<r.byteLength){if(t){o.default.w(this.TAG,n+" bytes unconsumed data remain when flush buffer, dropped")}else{if(i>0){var a=new Uint8Array(this._stashBuffer,0,this._bufferSize);var s=new Uint8Array(r,i);a.set(s,0);this._stashUsed=s.byteLength;this._stashByteStart+=i}return 0}}this._stashUsed=0;this._stashByteStart=0;return n}return 0}},{key:"_onLoaderComplete",value:function e(t,r){this._flushStashBuffer(true);if(this._onComplete){this._onComplete(this._extraData)}}},{key:"_onLoaderError",value:function e(t,r){o.default.e(this.TAG,"Loader error, code = "+r.code+", msg = "+r.msg);this._flushStashBuffer(false);if(this._isEarlyEofReconnecting){this._isEarlyEofReconnecting=false;t=u.LoaderErrors.UNRECOVERABLE_EARLY_EOF}switch(t){case u.LoaderErrors.EARLY_EOF:{if(!this._config.isLive){if(this._totalLength){var i=this._currentRange.to+1;if(i<this._totalLength){o.default.w(this.TAG,"Connection lost, trying reconnect...");this._isEarlyEofReconnecting=true;this._internalSeek(i,false)}return}}t=u.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case u.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case u.LoaderErrors.CONNECTING_TIMEOUT:case u.LoaderErrors.HTTP_STATUS_CODE_INVALID:case u.LoaderErrors.EXCEPTION:break}if(this._onError){this._onError(t,r)}else{throw new k.RuntimeException("IOException: "+r.msg)}}},{key:"status",get:function e(){return this._loader.status}},{key:"extraData",get:function e(){return this._extraData},set:function e(t){this._extraData=t}},{key:"onDataArrival",get:function e(){return this._onDataArrival},set:function e(t){this._onDataArrival=t}},{key:"onSeeked",get:function e(){return this._onSeeked},set:function e(t){this._onSeeked=t}},{key:"onError",get:function e(){return this._onError},set:function e(t){this._onError=t}},{key:"onComplete",get:function e(){return this._onComplete},set:function e(t){this._onComplete=t}},{key:"onRedirect",get:function e(){return this._onRedirect},set:function e(t){this._onRedirect=t}},{key:"onRecoveredEarlyEof",get:function e(){return this._onRecoveredEarlyEof},set:function e(t){this._onRecoveredEarlyEof=t}},{key:"currentURL",get:function e(){return this._dataSource.url}},{key:"hasRedirect",get:function e(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=undefined}},{key:"currentRedirectedURL",get:function e(){return this._redirectedURL||this._dataSource.redirectedURL}},{key:"currentSpeed",get:function e(){if(this._loaderClass===m.default){return this._loader.currentSpeed}return this._speedSampler.lastSecondKBps}},{key:"loaderType",get:function e(){return this._loader.type}}]);return i}();r.default=R},{"../utils/exception.js":40,"../utils/logger.js":41,"./fetch-stream-loader.js":22,"./loader.js":24,"./param-seek-handler.js":25,"./range-seek-handler.js":26,"./speed-sampler.js":27,"./websocket-loader.js":28,"./xhr-moz-chunked-loader.js":29,"./xhr-msstream-loader.js":30,"./xhr-range-loader.js":31}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.BaseLoader=r.LoaderErrors=r.LoaderStatus=undefined;var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var n=e("../utils/exception.js");function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=r.LoaderStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};var o=r.LoaderErrors={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"};var u=r.BaseLoader=function(){function t(e){a(this,t);this._type=e||"undefined";this._status=s.kIdle;this._needStash=false;this._onContentLengthKnown=null;this._onURLRedirect=null;this._onDataArrival=null;this._onError=null;this._onComplete=null}i(t,[{key:"destroy",value:function e(){this._status=s.kIdle;this._onContentLengthKnown=null;this._onURLRedirect=null;this._onDataArrival=null;this._onError=null;this._onComplete=null}},{key:"isWorking",value:function e(){return this._status===s.kConnecting||this._status===s.kBuffering}},{key:"open",value:function e(t,r){throw new n.NotImplementedException("Unimplemented abstract function!")}},{key:"abort",value:function e(){throw new n.NotImplementedException("Unimplemented abstract function!")}},{key:"type",get:function e(){return this._type}},{key:"status",get:function e(){return this._status}},{key:"needStashBuffer",get:function e(){return this._needStash}},{key:"onContentLengthKnown",get:function e(){return this._onContentLengthKnown},set:function e(t){this._onContentLengthKnown=t}},{key:"onURLRedirect",get:function e(){return this._onURLRedirect},set:function e(t){this._onURLRedirect=t}},{key:"onDataArrival",get:function e(){return this._onDataArrival},set:function e(t){this._onDataArrival=t}},{key:"onError",get:function e(){return this._onError},set:function e(t){this._onError=t}},{key:"onComplete",get:function e(){return this._onComplete},set:function e(t){this._onComplete=t}}]);return t}()},{"../utils/exception.js":40}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function r(e,t){n(this,r);this._startName=e;this._endName=t}i(r,[{key:"getConfig",value:function e(t,r){var i=t;if(r.from!==0||r.to!==-1){var n=true;if(i.indexOf("?")===-1){i+="?";n=false}if(n){i+="&"}i+=this._startName+"="+r.from.toString();if(r.to!==-1){i+="&"+this._endName+"="+r.to.toString()}}return{url:i,headers:{}}}},{key:"removeURLParameters",value:function e(t){var r=t.split("?")[0];var i=undefined;var n=t.indexOf("?");if(n!==-1){i=t.substring(n+1)}var a="";if(i!=undefined&&i.length>0){var s=i.split("&");for(var o=0;o<s.length;o++){var u=s[o].split("=");var l=o>0;if(u[0]!==this._startName&&u[0]!==this._endName){if(l){a+="&"}a+=s[o]}}}return a.length===0?r:r+"?"+a}}]);return r}();r.default=a},{}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function t(e){n(this,t);this._zeroStart=e||false}i(t,[{key:"getConfig",value:function e(t,r){var i={};if(r.from!==0||r.to!==-1){var n=void 0;if(r.to!==-1){n="bytes="+r.from.toString()+"-"+r.to.toString()}else{n="bytes="+r.from.toString()+"-"}i["Range"]=n}else if(this._zeroStart){i["Range"]="bytes=0-"}return{url:t,headers:i}}},{key:"removeURLParameters",value:function e(t){return t}}]);return t}();r.default=a},{}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e);this._firstCheckpoint=0;this._lastCheckpoint=0;this._intervalBytes=0;this._totalBytes=0;this._lastSecondBytes=0;if(self.performance&&self.performance.now){this._now=self.performance.now.bind(self.performance)}else{this._now=Date.now}}i(e,[{key:"reset",value:function e(){this._firstCheckpoint=this._lastCheckpoint=0;this._totalBytes=this._intervalBytes=0;this._lastSecondBytes=0}},{key:"addBytes",value:function e(t){if(this._firstCheckpoint===0){this._firstCheckpoint=this._now();this._lastCheckpoint=this._firstCheckpoint;this._intervalBytes+=t;this._totalBytes+=t}else if(this._now()-this._lastCheckpoint<1e3){this._intervalBytes+=t;this._totalBytes+=t}else{this._lastSecondBytes=this._intervalBytes;this._intervalBytes=t;this._totalBytes+=t;this._lastCheckpoint=this._now()}}},{key:"currentKBps",get:function e(){this.addBytes(0);var t=(this._now()-this._lastCheckpoint)/1e3;if(t==0)t=1;return this._intervalBytes/t/1024}},{key:"lastSecondKBps",get:function e(){this.addBytes(0);if(this._lastSecondBytes!==0){return this._lastSecondBytes/1024}else{if(this._now()-this._lastCheckpoint>=500){return this.currentKBps}else{return 0}}}},{key:"averageKBps",get:function e(){var t=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/t/1024}}]);return e}();r.default=a},{}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function e(t,r,i){if(t===null)t=Function.prototype;var n=Object.getOwnPropertyDescriptor(t,r);if(n===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,r,i)}}else if("value"in n){return n.value}else{var s=n.get;if(s===undefined){return undefined}return s.call(i)}};var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var a=e("../utils/logger.js");var s=l(a);var o=e("./loader.js");var u=e("../utils/exception.js");function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function d(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=function(e){h(t,e);n(t,null,[{key:"isSupported",value:function e(){try{return typeof self.WebSocket!=="undefined"}catch(e){return false}}}]);function t(){f(this,t);var e=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"websocket-loader"));e.TAG="WebSocketLoader";e._needStash=true;e._ws=null;e._requestAbort=false;e._receivedLength=0;return e}n(t,[{key:"destroy",value:function e(){if(this._ws){this.abort()}i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function e(t){try{var r=this._ws=new self.WebSocket(t.url);r.binaryType="arraybuffer";r.onopen=this._onWebSocketOpen.bind(this);r.onclose=this._onWebSocketClose.bind(this);r.onmessage=this._onWebSocketMessage.bind(this);r.onerror=this._onWebSocketError.bind(this);this._status=o.LoaderStatus.kConnecting}catch(e){this._status=o.LoaderStatus.kError;var i={code:e.code,msg:e.message};if(this._onError){this._onError(o.LoaderErrors.EXCEPTION,i)}else{throw new u.RuntimeException(i.msg)}}}},{key:"abort",value:function e(){var t=this._ws;if(t&&(t.readyState===0||t.readyState===1)){this._requestAbort=true;t.close()}this._ws=null;this._status=o.LoaderStatus.kComplete}},{key:"_onWebSocketOpen",value:function e(t){this._status=o.LoaderStatus.kBuffering}},{key:"_onWebSocketClose",value:function e(t){if(this._requestAbort===true){this._requestAbort=false;return}this._status=o.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(0,this._receivedLength-1)}}},{key:"_onWebSocketMessage",value:function e(t){var r=this;if(t.data instanceof ArrayBuffer){this._dispatchArrayBuffer(t.data)}else if(t.data instanceof Blob){var i=new FileReader;i.onload=function(){r._dispatchArrayBuffer(i.result)};i.readAsArrayBuffer(t.data)}else{this._status=o.LoaderStatus.kError;var n={code:-1,msg:"Unsupported WebSocket message type: "+t.data.constructor.name};if(this._onError){this._onError(o.LoaderErrors.EXCEPTION,n)}else{throw new u.RuntimeException(n.msg)}}}},{key:"_dispatchArrayBuffer",value:function e(t){var r=t;var i=this._receivedLength;this._receivedLength+=r.byteLength;if(this._onDataArrival){this._onDataArrival(r,i,this._receivedLength)}}},{key:"_onWebSocketError",value:function e(t){this._status=o.LoaderStatus.kError;var r={code:t.code,msg:t.message};if(this._onError){this._onError(o.LoaderErrors.EXCEPTION,r)}else{throw new u.RuntimeException(r.msg)}}}]);return t}(o.BaseLoader);r.default=c},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var f=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function e(t,r,i){if(t===null)t=Function.prototype;var n=Object.getOwnPropertyDescriptor(t,r);if(n===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,r,i)}}else if("value"in n){return n.value}else{var s=n.get;if(s===undefined){return undefined}return s.call(i)}};var a=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var i=e("../utils/logger.js");var s=u(i);var d=e("./loader.js");var o=e("../utils/exception.js");function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function h(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var _=function(e){c(i,e);a(i,null,[{key:"isSupported",value:function e(){try{var t=new XMLHttpRequest;t.open("GET","https://example.com",true);t.responseType="moz-chunked-arraybuffer";return t.responseType==="moz-chunked-arraybuffer"}catch(e){s.default.w("MozChunkedLoader",e.message);return false}}}]);function i(e,t){l(this,i);var r=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"xhr-moz-chunked-loader"));r.TAG="MozChunkedLoader";r._seekHandler=e;r._config=t;r._needStash=true;r._xhr=null;r._requestAbort=false;r._contentLength=null;r._receivedLength=0;return r}a(i,[{key:"destroy",value:function e(){if(this.isWorking()){this.abort()}if(this._xhr){this._xhr.onreadystatechange=null;this._xhr.onprogress=null;this._xhr.onloadend=null;this._xhr.onerror=null;this._xhr=null}n(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}},{key:"open",value:function e(t,r){this._dataSource=t;this._range=r;var i=t.url;if(this._config.reuseRedirectedURL&&t.redirectedURL!=undefined){i=t.redirectedURL}var n=this._seekHandler.getConfig(i,r);this._requestURL=n.url;var a=this._xhr=new XMLHttpRequest;a.open("GET",n.url,true);a.responseType="moz-chunked-arraybuffer";a.onreadystatechange=this._onReadyStateChange.bind(this);a.onprogress=this._onProgress.bind(this);a.onloadend=this._onLoadEnd.bind(this);a.onerror=this._onXhrError.bind(this);if(t.withCredentials){a.withCredentials=true}if(f(n.headers)==="object"){var s=n.headers;for(var o in s){if(s.hasOwnProperty(o)){a.setRequestHeader(o,s[o])}}}if(f(this._config.headers)==="object"){var u=this._config.headers;for(var l in u){if(u.hasOwnProperty(l)){a.setRequestHeader(l,u[l])}}}this._status=d.LoaderStatus.kConnecting;a.send()}},{key:"abort",value:function e(){this._requestAbort=true;if(this._xhr){this._xhr.abort()}this._status=d.LoaderStatus.kComplete}},{key:"_onReadyStateChange",value:function e(t){var r=t.target;if(r.readyState===2){if(r.responseURL!=undefined&&r.responseURL!==this._requestURL){if(this._onURLRedirect){var i=this._seekHandler.removeURLParameters(r.responseURL);this._onURLRedirect(i)}}if(r.status!==0&&(r.status<200||r.status>299)){this._status=d.LoaderStatus.kError;if(this._onError){this._onError(d.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:r.status,msg:r.statusText})}else{throw new o.RuntimeException("MozChunkedLoader: Http code invalid, "+r.status+" "+r.statusText)}}else{this._status=d.LoaderStatus.kBuffering}}}},{key:"_onProgress",value:function e(t){if(this._status===d.LoaderStatus.kError){return}if(this._contentLength===null){if(t.total!==null&&t.total!==0){this._contentLength=t.total;if(this._onContentLengthKnown){this._onContentLengthKnown(this._contentLength)}}}var r=t.target.response;var i=this._range.from+this._receivedLength;this._receivedLength+=r.byteLength;if(this._onDataArrival){this._onDataArrival(r,i,this._receivedLength)}}},{key:"_onLoadEnd",value:function e(t){if(this._requestAbort===true){this._requestAbort=false;return}else if(this._status===d.LoaderStatus.kError){return}this._status=d.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(this._range.from,this._range.from+this._receivedLength-1)}}},{key:"_onXhrError",value:function e(t){this._status=d.LoaderStatus.kError;var r=0;var i=null;if(this._contentLength&&t.loaded<this._contentLength){r=d.LoaderErrors.EARLY_EOF;i={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}}else{r=d.LoaderErrors.EXCEPTION;i={code:-1,msg:t.constructor.name+" "+t.type}}if(this._onError){this._onError(r,i)}else{throw new o.RuntimeException(i.msg)}}}]);return i}(d.BaseLoader);r.default=_},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var h=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function e(t,r,i){if(t===null)t=Function.prototype;var n=Object.getOwnPropertyDescriptor(t,r);if(n===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,r,i)}}else if("value"in n){return n.value}else{var s=n.get;if(s===undefined){return undefined}return s.call(i)}};var a=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var i=e("../utils/logger.js");var s=u(i);var c=e("./loader.js");var o=e("../utils/exception.js");function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function d(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var _=function(e){d(i,e);a(i,null,[{key:"isSupported",value:function e(){try{if(typeof self.MSStream==="undefined"||typeof self.MSStreamReader==="undefined"){return false}var t=new XMLHttpRequest;t.open("GET","https://example.com",true);t.responseType="ms-stream";return t.responseType==="ms-stream"}catch(e){s.default.w("MSStreamLoader",e.message);return false}}}]);function i(e,t){l(this,i);var r=f(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"xhr-msstream-loader"));r.TAG="MSStreamLoader";r._seekHandler=e;r._config=t;r._needStash=true;r._xhr=null;r._reader=null;r._totalRange=null;r._currentRange=null;r._currentRequestURL=null;r._currentRedirectedURL=null;r._contentLength=null;r._receivedLength=0;r._bufferLimit=16*1024*1024;r._lastTimeBufferSize=0;r._isReconnecting=false;return r}a(i,[{key:"destroy",value:function e(){if(this.isWorking()){this.abort()}if(this._reader){this._reader.onprogress=null;this._reader.onload=null;this._reader.onerror=null;this._reader=null}if(this._xhr){this._xhr.onreadystatechange=null;this._xhr=null}n(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}},{key:"open",value:function e(t,r){this._internalOpen(t,r,false)}},{key:"_internalOpen",value:function e(t,r,i){this._dataSource=t;if(!i){this._totalRange=r}else{this._currentRange=r}var n=t.url;if(this._config.reuseRedirectedURL){if(this._currentRedirectedURL!=undefined){n=this._currentRedirectedURL}else if(t.redirectedURL!=undefined){n=t.redirectedURL}}var a=this._seekHandler.getConfig(n,r);this._currentRequestURL=a.url;var s=this._reader=new self.MSStreamReader;s.onprogress=this._msrOnProgress.bind(this);s.onload=this._msrOnLoad.bind(this);s.onerror=this._msrOnError.bind(this);var o=this._xhr=new XMLHttpRequest;o.open("GET",a.url,true);o.responseType="ms-stream";o.onreadystatechange=this._xhrOnReadyStateChange.bind(this);o.onerror=this._xhrOnError.bind(this);if(t.withCredentials){o.withCredentials=true}if(h(a.headers)==="object"){var u=a.headers;for(var l in u){if(u.hasOwnProperty(l)){o.setRequestHeader(l,u[l])}}}if(h(this._config.headers)==="object"){var f=this._config.headers;for(var d in f){if(f.hasOwnProperty(d)){o.setRequestHeader(d,f[d])}}}if(this._isReconnecting){this._isReconnecting=false}else{this._status=c.LoaderStatus.kConnecting}o.send()}},{key:"abort",value:function e(){this._internalAbort();this._status=c.LoaderStatus.kComplete}},{key:"_internalAbort",value:function e(){if(this._reader){if(this._reader.readyState===1){this._reader.abort()}this._reader.onprogress=null;this._reader.onload=null;this._reader.onerror=null;this._reader=null}if(this._xhr){this._xhr.abort();this._xhr.onreadystatechange=null;this._xhr=null}}},{key:"_xhrOnReadyStateChange",value:function e(t){var r=t.target;if(r.readyState===2){if(r.status>=200&&r.status<=299){this._status=c.LoaderStatus.kBuffering;if(r.responseURL!=undefined){var i=this._seekHandler.removeURLParameters(r.responseURL);if(r.responseURL!==this._currentRequestURL&&i!==this._currentRedirectedURL){this._currentRedirectedURL=i;if(this._onURLRedirect){this._onURLRedirect(i)}}}var n=r.getResponseHeader("Content-Length");if(n!=null&&this._contentLength==null){var a=parseInt(n);if(a>0){this._contentLength=a;if(this._onContentLengthKnown){this._onContentLengthKnown(this._contentLength)}}}}else{this._status=c.LoaderStatus.kError;if(this._onError){this._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:r.status,msg:r.statusText})}else{throw new o.RuntimeException("MSStreamLoader: Http code invalid, "+r.status+" "+r.statusText)}}}else if(r.readyState===3){if(r.status>=200&&r.status<=299){this._status=c.LoaderStatus.kBuffering;var s=r.response;this._reader.readAsArrayBuffer(s)}}}},{key:"_xhrOnError",value:function e(t){this._status=c.LoaderStatus.kError;var r=c.LoaderErrors.EXCEPTION;var i={code:-1,msg:t.constructor.name+" "+t.type};if(this._onError){this._onError(r,i)}else{throw new o.RuntimeException(i.msg)}}},{key:"_msrOnProgress",value:function e(t){var r=t.target;var i=r.result;if(i==null){this._doReconnectIfNeeded();return}var n=i.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=i.byteLength;var a=this._totalRange.from+this._receivedLength;this._receivedLength+=n.byteLength;if(this._onDataArrival){this._onDataArrival(n,a,this._receivedLength)}if(i.byteLength>=this._bufferLimit){s.default.v(this.TAG,"MSStream buffer exceeded max size near "+(a+n.byteLength)+", reconnecting...");this._doReconnectIfNeeded()}}},{key:"_doReconnectIfNeeded",value:function e(){if(this._contentLength==null||this._receivedLength<this._contentLength){this._isReconnecting=true;this._lastTimeBufferSize=0;this._internalAbort();var t={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,t,true)}}},{key:"_msrOnLoad",value:function e(t){this._status=c.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)}}},{key:"_msrOnError",value:function e(t){this._status=c.LoaderStatus.kError;var r=0;var i=null;if(this._contentLength&&this._receivedLength<this._contentLength){r=c.LoaderErrors.EARLY_EOF;i={code:-1,msg:"MSStream meet Early-Eof"}}else{r=c.LoaderErrors.EARLY_EOF;i={code:-1,msg:t.constructor.name+" "+t.type}}if(this._onError){this._onError(r,i)}else{throw new o.RuntimeException(i.msg)}}}]);return i}(c.BaseLoader);r.default=_},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var f=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function e(t,r,i){if(t===null)t=Function.prototype;var n=Object.getOwnPropertyDescriptor(t,r);if(n===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,r,i)}}else if("value"in n){return n.value}else{var s=n.get;if(s===undefined){return undefined}return s.call(i)}};var a=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var i=e("../utils/logger.js");var s=h(i);var o=e("./speed-sampler.js");var u=h(o);var l=e("./loader.js");var d=e("../utils/exception.js");function h(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function v(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var m=function(e){v(i,e);a(i,null,[{key:"isSupported",value:function e(){try{var t=new XMLHttpRequest;t.open("GET","https://example.com",true);t.responseType="arraybuffer";return t.responseType==="arraybuffer"}catch(e){s.default.w("RangeLoader",e.message);return false}}}]);function i(e,t){c(this,i);var r=_(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"xhr-range-loader"));r.TAG="RangeLoader";r._seekHandler=e;r._config=t;r._needStash=false;r._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192];r._currentChunkSizeKB=384;r._currentSpeedNormalized=0;r._zeroSpeedChunkCount=0;r._xhr=null;r._speedSampler=new u.default;r._requestAbort=false;r._waitForTotalLength=false;r._totalLengthReceived=false;r._currentRequestURL=null;r._currentRedirectedURL=null;r._currentRequestRange=null;r._totalLength=null;r._contentLength=null;r._receivedLength=0;r._lastTimeLoaded=0;return r}a(i,[{key:"destroy",value:function e(){if(this.isWorking()){this.abort()}if(this._xhr){this._xhr.onreadystatechange=null;this._xhr.onprogress=null;this._xhr.onload=null;this._xhr.onerror=null;this._xhr=null}n(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}},{key:"open",value:function e(t,r){this._dataSource=t;this._range=r;this._status=l.LoaderStatus.kConnecting;var i=false;if(this._dataSource.filesize!=undefined&&this._dataSource.filesize!==0){i=true;this._totalLength=this._dataSource.filesize}if(!this._totalLengthReceived&&!i){this._waitForTotalLength=true;this._internalOpen(this._dataSource,{from:0,to:-1})}else{this._openSubRange()}}},{key:"_openSubRange",value:function e(){var t=this._currentChunkSizeKB*1024;var r=this._range.from+this._receivedLength;var i=r+t;if(this._contentLength!=null){if(i-this._range.from>=this._contentLength){i=this._range.from+this._contentLength-1}}this._currentRequestRange={from:r,to:i};this._internalOpen(this._dataSource,this._currentRequestRange)}},{key:"_internalOpen",value:function e(t,r){this._lastTimeLoaded=0;var i=t.url;if(this._config.reuseRedirectedURL){if(this._currentRedirectedURL!=undefined){i=this._currentRedirectedURL}else if(t.redirectedURL!=undefined){i=t.redirectedURL}}var n=this._seekHandler.getConfig(i,r);this._currentRequestURL=n.url;var a=this._xhr=new XMLHttpRequest;a.open("GET",n.url,true);a.responseType="arraybuffer";a.onreadystatechange=this._onReadyStateChange.bind(this);a.onprogress=this._onProgress.bind(this);a.onload=this._onLoad.bind(this);a.onerror=this._onXhrError.bind(this);if(t.withCredentials){a.withCredentials=true}if(f(n.headers)==="object"){var s=n.headers;for(var o in s){if(s.hasOwnProperty(o)){a.setRequestHeader(o,s[o])}}}if(f(this._config.headers)==="object"){var u=this._config.headers;for(var l in u){if(u.hasOwnProperty(l)){a.setRequestHeader(l,u[l])}}}a.send()}},{key:"abort",value:function e(){this._requestAbort=true;this._internalAbort();this._status=l.LoaderStatus.kComplete}},{key:"_internalAbort",value:function e(){if(this._xhr){this._xhr.onreadystatechange=null;this._xhr.onprogress=null;this._xhr.onload=null;this._xhr.onerror=null;this._xhr.abort();this._xhr=null}}},{key:"_onReadyStateChange",value:function e(t){var r=t.target;if(r.readyState===2){if(r.responseURL!=undefined){var i=this._seekHandler.removeURLParameters(r.responseURL);if(r.responseURL!==this._currentRequestURL&&i!==this._currentRedirectedURL){this._currentRedirectedURL=i;if(this._onURLRedirect){this._onURLRedirect(i)}}}if(r.status>=200&&r.status<=299){if(this._waitForTotalLength){return}this._status=l.LoaderStatus.kBuffering}else{this._status=l.LoaderStatus.kError;if(this._onError){this._onError(l.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:r.status,msg:r.statusText})}else{throw new d.RuntimeException("RangeLoader: Http code invalid, "+r.status+" "+r.statusText)}}}}},{key:"_onProgress",value:function e(t){if(this._status===l.LoaderStatus.kError){return}if(this._contentLength===null){var r=false;if(this._waitForTotalLength){this._waitForTotalLength=false;this._totalLengthReceived=true;r=true;var i=t.total;this._internalAbort();if(i!=null&i!==0){this._totalLength=i}}if(this._range.to===-1){this._contentLength=this._totalLength-this._range.from}else{this._contentLength=this._range.to-this._range.from+1}if(r){this._openSubRange();return}if(this._onContentLengthKnown){this._onContentLengthKnown(this._contentLength)}}var n=t.loaded-this._lastTimeLoaded;this._lastTimeLoaded=t.loaded;this._speedSampler.addBytes(n)}},{key:"_normalizeSpeed",value:function e(t){var r=this._chunkSizeKBList;var i=r.length-1;var n=0;var a=0;var s=i;if(t<r[0]){return r[0]}while(a<=s){n=a+Math.floor((s-a)/2);if(n===i||t>=r[n]&&t<r[n+1]){return r[n]}else if(r[n]<t){a=n+1}else{s=n-1}}}},{key:"_onLoad",value:function e(t){if(this._status===l.LoaderStatus.kError){return}if(this._waitForTotalLength){this._waitForTotalLength=false;return}this._lastTimeLoaded=0;var r=this._speedSampler.lastSecondKBps;if(r===0){this._zeroSpeedChunkCount++;if(this._zeroSpeedChunkCount>=3){r=this._speedSampler.currentKBps}}if(r!==0){var i=this._normalizeSpeed(r);if(this._currentSpeedNormalized!==i){this._currentSpeedNormalized=i;this._currentChunkSizeKB=i}}var n=t.target.response;var a=this._range.from+this._receivedLength;this._receivedLength+=n.byteLength;var s=false;if(this._contentLength!=null&&this._receivedLength<this._contentLength){this._openSubRange()}else{s=true}if(this._onDataArrival){this._onDataArrival(n,a,this._receivedLength)}if(s){this._status=l.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(this._range.from,this._range.from+this._receivedLength-1)}}}},{key:"_onXhrError",value:function e(t){this._status=l.LoaderStatus.kError;var r=0;var i=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength){r=l.LoaderErrors.EARLY_EOF;i={code:-1,msg:"RangeLoader meet Early-Eof"}}else{r=l.LoaderErrors.EXCEPTION;i={code:-1,msg:t.constructor.name+" "+t.type}}if(this._onError){this._onError(r,i)}else{throw new d.RuntimeException(i.msg)}}},{key:"currentSpeed",get:function e(){return this._speedSampler.lastSecondKBps}}]);return i}(l.BaseLoader);r.default=m},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24,"./speed-sampler.js":27}],32:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var a=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var i=e("events");var s=L(i);var o=e("../utils/logger.js");var u=L(o);var l=e("../utils/browser.js");var f=L(l);var d=e("./player-events.js");var h=L(d);var c=e("../core/transmuxer.js");var _=L(c);var v=e("../core/transmuxing-events.js");var m=L(v);var p=e("../core/mse-controller.js");var g=L(p);var y=e("../core/mse-events.js");var E=L(y);var b=e("./player-errors.js");var S=e("../config.js");var k=e("../utils/exception.js");function L(e){return e&&e.__esModule?e:{default:e}}function w(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var R=function(){function i(e,t){w(this,i);this.TAG="FlvPlayer";this._type="FlvPlayer";this._emitter=new s.default;this._config=(0,S.createDefaultConfig)();if((typeof t==="undefined"?"undefined":n(t))==="object"){Object.assign(this._config,t)}if(e.type.toLowerCase()!=="flv"){throw new k.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!")}if(e.isLive===true){this._config.isLive=true}this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)};if(self.performance&&self.performance.now){this._now=self.performance.now.bind(self.performance)}else{this._now=Date.now}this._pendingSeekTime=null;this._requestSetTime=false;this._seekpointRecord=null;this._progressChecker=null;this._mediaDataSource=e;this._mediaElement=null;this._msectl=null;this._transmuxer=null;this._mseSourceOpened=false;this._hasPendingLoad=false;this._receivedCanPlay=false;this._mediaInfo=null;this._statisticsInfo=null;var r=f.default.chrome&&(f.default.version.major<50||f.default.version.major===50&&f.default.version.build<2661);this._alwaysSeekKeyframe=r||f.default.msedge||f.default.msie?true:false;if(this._alwaysSeekKeyframe){this._config.accurateSeek=false}}a(i,[{key:"destroy",value:function e(){if(this._progressChecker!=null){window.clearInterval(this._progressChecker);this._progressChecker=null}if(this._transmuxer){this.unload()}if(this._mediaElement){this.detachMediaElement()}this.e=null;this._mediaDataSource=null;this._emitter.removeAllListeners();this._emitter=null}},{key:"on",value:function e(t,r){var i=this;if(t===h.default.MEDIA_INFO){if(this._mediaInfo!=null){Promise.resolve().then(function(){i._emitter.emit(h.default.MEDIA_INFO,i.mediaInfo)})}}else if(t===h.default.STATISTICS_INFO){if(this._statisticsInfo!=null){Promise.resolve().then(function(){i._emitter.emit(h.default.STATISTICS_INFO,i.statisticsInfo)})}}this._emitter.addListener(t,r)}},{key:"off",value:function e(t,r){this._emitter.removeListener(t,r)}},{key:"attachMediaElement",value:function e(t){var r=this;this._mediaElement=t;t.addEventListener("loadedmetadata",this.e.onvLoadedMetadata);t.addEventListener("seeking",this.e.onvSeeking);t.addEventListener("canplay",this.e.onvCanPlay);t.addEventListener("stalled",this.e.onvStalled);t.addEventListener("progress",this.e.onvProgress);this._msectl=new g.default(this._config);this._msectl.on(E.default.UPDATE_END,this._onmseUpdateEnd.bind(this));this._msectl.on(E.default.BUFFER_FULL,this._onmseBufferFull.bind(this));this._msectl.on(E.default.SOURCE_OPEN,function(){r._mseSourceOpened=true;if(r._hasPendingLoad){r._hasPendingLoad=false;r.load()}});this._msectl.on(E.default.ERROR,function(e){r._emitter.emit(h.default.ERROR,b.ErrorTypes.MEDIA_ERROR,b.ErrorDetails.MEDIA_MSE_ERROR,e)});this._msectl.attachMediaElement(t);if(this._pendingSeekTime!=null){try{t.currentTime=this._pendingSeekTime;this._pendingSeekTime=null}catch(e){}}}},{key:"detachMediaElement",value:function e(){if(this._mediaElement){this._msectl.detachMediaElement();this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata);this._mediaElement.removeEventListener("seeking",this.e.onvSeeking);this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay);this._mediaElement.removeEventListener("stalled",this.e.onvStalled);this._mediaElement.removeEventListener("progress",this.e.onvProgress);this._mediaElement=null}if(this._msectl){this._msectl.destroy();this._msectl=null}}},{key:"load",value:function e(){var i=this;if(!this._mediaElement){throw new k.IllegalStateException("HTMLMediaElement must be attached before load()!")}if(this._transmuxer){throw new k.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!")}if(this._hasPendingLoad){return}if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===false){this._hasPendingLoad=true;return}if(this._mediaElement.readyState>0){this._requestSetTime=true;this._mediaElement.currentTime=0}this._transmuxer=new _.default(this._mediaDataSource,this._config);this._transmuxer.on(m.default.INIT_SEGMENT,function(e,t){i._msectl.appendInitSegment(t)});this._transmuxer.on(m.default.MEDIA_SEGMENT,function(e,t){i._msectl.appendMediaSegment(t);if(i._config.lazyLoad&&!i._config.isLive){var r=i._mediaElement.currentTime;if(t.info.endDts>=(r+i._config.lazyLoadMaxDuration)*1e3){if(i._progressChecker==null){u.default.v(i.TAG,"Maximum buffering duration exceeded, suspend transmuxing task");i._suspendTransmuxer()}}}});this._transmuxer.on(m.default.LOADING_COMPLETE,function(){i._msectl.endOfStream();i._emitter.emit(h.default.LOADING_COMPLETE)});this._transmuxer.on(m.default.RECOVERED_EARLY_EOF,function(){i._emitter.emit(h.default.RECOVERED_EARLY_EOF)});this._transmuxer.on(m.default.IO_ERROR,function(e,t){i._emitter.emit(h.default.ERROR,b.ErrorTypes.NETWORK_ERROR,e,t)});this._transmuxer.on(m.default.DEMUX_ERROR,function(e,t){i._emitter.emit(h.default.ERROR,b.ErrorTypes.MEDIA_ERROR,e,{code:-1,msg:t})});this._transmuxer.on(m.default.MEDIA_INFO,function(e){i._mediaInfo=e;i._emitter.emit(h.default.MEDIA_INFO,Object.assign({},e))});this._transmuxer.on(m.default.METADATA_ARRIVED,function(e){i._emitter.emit(h.default.METADATA_ARRIVED,e)});this._transmuxer.on(m.default.SCRIPTDATA_ARRIVED,function(e){i._emitter.emit(h.default.SCRIPTDATA_ARRIVED,e)});this._transmuxer.on(m.default.STATISTICS_INFO,function(e){i._statisticsInfo=i._fillStatisticsInfo(e);i._emitter.emit(h.default.STATISTICS_INFO,Object.assign({},i._statisticsInfo))});this._transmuxer.on(m.default.RECOMMEND_SEEKPOINT,function(e){if(i._mediaElement&&!i._config.accurateSeek){i._requestSetTime=true;i._mediaElement.currentTime=e/1e3}});this._transmuxer.open()}},{key:"unload",value:function e(){if(this._mediaElement){this._mediaElement.pause()}if(this._msectl){this._msectl.seek(0)}if(this._transmuxer){this._transmuxer.close();this._transmuxer.destroy();this._transmuxer=null}}},{key:"play",value:function e(){return this._mediaElement.play()}},{key:"pause",value:function e(){this._mediaElement.pause()}},{key:"_fillStatisticsInfo",value:function e(t){t.playerType=this._type;if(!(this._mediaElement instanceof HTMLVideoElement)){return t}var r=true;var i=0;var n=0;if(this._mediaElement.getVideoPlaybackQuality){var a=this._mediaElement.getVideoPlaybackQuality();i=a.totalVideoFrames;n=a.droppedVideoFrames}else if(this._mediaElement.webkitDecodedFrameCount!=undefined){i=this._mediaElement.webkitDecodedFrameCount;n=this._mediaElement.webkitDroppedFrameCount}else{r=false}if(r){t.decodedFrames=i;t.droppedFrames=n}return t}},{key:"_onmseUpdateEnd",value:function e(){if(!this._config.lazyLoad||this._config.isLive){return}var t=this._mediaElement.buffered;var r=this._mediaElement.currentTime;var i=0;var n=0;for(var a=0;a<t.length;a++){var s=t.start(a);var o=t.end(a);if(s<=r&&r<o){i=s;n=o;break}}if(n>=r+this._config.lazyLoadMaxDuration&&this._progressChecker==null){u.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task");this._suspendTransmuxer()}}},{key:"_onmseBufferFull",value:function e(){u.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task");if(this._progressChecker==null){this._suspendTransmuxer()}}},{key:"_suspendTransmuxer",value:function e(){if(this._transmuxer){this._transmuxer.pause();if(this._progressChecker==null){this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)}}}},{key:"_checkProgressAndResume",value:function e(){var t=this._mediaElement.currentTime;var r=this._mediaElement.buffered;var i=false;for(var n=0;n<r.length;n++){var a=r.start(n);var s=r.end(n);if(t>=a&&t<s){if(t>=s-this._config.lazyLoadRecoverDuration){i=true}break}}if(i){window.clearInterval(this._progressChecker);this._progressChecker=null;if(i){u.default.v(this.TAG,"Continue loading from paused position");this._transmuxer.resume()}}}},{key:"_isTimepointBuffered",value:function e(t){var r=this._mediaElement.buffered;for(var i=0;i<r.length;i++){var n=r.start(i);var a=r.end(i);if(t>=n&&t<a){return true}}return false}},{key:"_internalSeek",value:function e(t){var r=this._isTimepointBuffered(t);var i=false;var n=0;if(t<1&&this._mediaElement.buffered.length>0){var a=this._mediaElement.buffered.start(0);if(a<1&&t<a||f.default.safari){i=true;n=f.default.safari?.1:a}}if(i){this._requestSetTime=true;this._mediaElement.currentTime=n}else if(r){if(!this._alwaysSeekKeyframe){this._requestSetTime=true;this._mediaElement.currentTime=t}else{var s=this._msectl.getNearestKeyframe(Math.floor(t*1e3));this._requestSetTime=true;if(s!=null){this._mediaElement.currentTime=s.dts/1e3}else{this._mediaElement.currentTime=t}}if(this._progressChecker!=null){this._checkProgressAndResume()}}else{if(this._progressChecker!=null){window.clearInterval(this._progressChecker);this._progressChecker=null}this._msectl.seek(t);this._transmuxer.seek(Math.floor(t*1e3));if(this._config.accurateSeek){this._requestSetTime=true;this._mediaElement.currentTime=t}}}},{key:"_checkAndApplyUnbufferedSeekpoint",value:function e(){if(this._seekpointRecord){if(this._seekpointRecord.recordTime<=this._now()-100){var t=this._mediaElement.currentTime;this._seekpointRecord=null;if(!this._isTimepointBuffered(t)){if(this._progressChecker!=null){window.clearTimeout(this._progressChecker);this._progressChecker=null}this._msectl.seek(t);this._transmuxer.seek(Math.floor(t*1e3));if(this._config.accurateSeek){this._requestSetTime=true;this._mediaElement.currentTime=t}}}else{window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}}}},{key:"_checkAndResumeStuckPlayback",value:function e(t){var r=this._mediaElement;if(t||!this._receivedCanPlay||r.readyState<2){var i=r.buffered;if(i.length>0&&r.currentTime<i.start(0)){u.default.w(this.TAG,"Playback seems stuck at "+r.currentTime+", seek to "+i.start(0));this._requestSetTime=true;this._mediaElement.currentTime=i.start(0);this._mediaElement.removeEventListener("progress",this.e.onvProgress)}}else{this._mediaElement.removeEventListener("progress",this.e.onvProgress)}}},{key:"_onvLoadedMetadata",value:function e(t){if(this._pendingSeekTime!=null){this._mediaElement.currentTime=this._pendingSeekTime;this._pendingSeekTime=null}}},{key:"_onvSeeking",value:function e(t){var r=this._mediaElement.currentTime;var i=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=false;return}if(r<1&&i.length>0){var n=i.start(0);if(n<1&&r<n||f.default.safari){this._requestSetTime=true;this._mediaElement.currentTime=f.default.safari?.1:n;return}}if(this._isTimepointBuffered(r)){if(this._alwaysSeekKeyframe){var a=this._msectl.getNearestKeyframe(Math.floor(r*1e3));if(a!=null){this._requestSetTime=true;this._mediaElement.currentTime=a.dts/1e3}}if(this._progressChecker!=null){this._checkProgressAndResume()}return}this._seekpointRecord={seekPoint:r,recordTime:this._now()};window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_onvCanPlay",value:function e(t){this._receivedCanPlay=true;this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)}},{key:"_onvStalled",value:function e(t){this._checkAndResumeStuckPlayback(true)}},{key:"_onvProgress",value:function e(t){this._checkAndResumeStuckPlayback()}},{key:"type",get:function e(){return this._type}},{key:"buffered",get:function e(){return this._mediaElement.buffered}},{key:"duration",get:function e(){return this._mediaElement.duration}},{key:"volume",get:function e(){return this._mediaElement.volume},set:function e(t){this._mediaElement.volume=t}},{key:"muted",get:function e(){return this._mediaElement.muted},set:function e(t){this._mediaElement.muted=t}},{key:"currentTime",get:function e(){if(this._mediaElement){return this._mediaElement.currentTime}return 0},set:function e(t){if(this._mediaElement){this._internalSeek(t)}else{this._pendingSeekTime=t}}},{key:"mediaInfo",get:function e(){return Object.assign({},this._mediaInfo)}},{key:"statisticsInfo",get:function e(){if(this._statisticsInfo==null){this._statisticsInfo={}}this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo);return Object.assign({},this._statisticsInfo)}}]);return i}();r.default=R},{"../config.js":5,"../core/mse-controller.js":9,"../core/mse-events.js":10,"../core/transmuxer.js":11,"../core/transmuxing-events.js":13,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./player-errors.js":34,"./player-events.js":35,events:2}],33:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var a=e("events");var s=d(a);var o=e("./player-events.js");var u=d(o);var l=e("../config.js");var f=e("../utils/exception.js");function d(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function r(e,t){h(this,r);this.TAG="NativePlayer";this._type="NativePlayer";this._emitter=new s.default;this._config=(0,l.createDefaultConfig)();if((typeof t==="undefined"?"undefined":i(t))==="object"){Object.assign(this._config,t)}if(e.type.toLowerCase()==="flv"){throw new f.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!")}if(e.hasOwnProperty("segments")){throw new f.InvalidArgumentException("NativePlayer("+e.type+") doesn't support multipart playback!")}this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)};this._pendingSeekTime=null;this._statisticsReporter=null;this._mediaDataSource=e;this._mediaElement=null}n(r,[{key:"destroy",value:function e(){if(this._mediaElement){this.unload();this.detachMediaElement()}this.e=null;this._mediaDataSource=null;this._emitter.removeAllListeners();this._emitter=null}},{key:"on",value:function e(t,r){var i=this;if(t===u.default.MEDIA_INFO){if(this._mediaElement!=null&&this._mediaElement.readyState!==0){Promise.resolve().then(function(){i._emitter.emit(u.default.MEDIA_INFO,i.mediaInfo)})}}else if(t===u.default.STATISTICS_INFO){if(this._mediaElement!=null&&this._mediaElement.readyState!==0){Promise.resolve().then(function(){i._emitter.emit(u.default.STATISTICS_INFO,i.statisticsInfo)})}}this._emitter.addListener(t,r)}},{key:"off",value:function e(t,r){this._emitter.removeListener(t,r)}},{key:"attachMediaElement",value:function e(t){this._mediaElement=t;t.addEventListener("loadedmetadata",this.e.onvLoadedMetadata);if(this._pendingSeekTime!=null){try{t.currentTime=this._pendingSeekTime;this._pendingSeekTime=null}catch(e){}}}},{key:"detachMediaElement",value:function e(){if(this._mediaElement){this._mediaElement.src="";this._mediaElement.removeAttribute("src");this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata);this._mediaElement=null}if(this._statisticsReporter!=null){window.clearInterval(this._statisticsReporter);this._statisticsReporter=null}}},{key:"load",value:function e(){if(!this._mediaElement){throw new f.IllegalStateException("HTMLMediaElement must be attached before load()!")}this._mediaElement.src=this._mediaDataSource.url;if(this._mediaElement.readyState>0){this._mediaElement.currentTime=0}this._mediaElement.preload="auto";this._mediaElement.load();this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)}},{key:"unload",value:function e(){if(this._mediaElement){this._mediaElement.src="";this._mediaElement.removeAttribute("src")}if(this._statisticsReporter!=null){window.clearInterval(this._statisticsReporter);this._statisticsReporter=null}}},{key:"play",value:function e(){return this._mediaElement.play()}},{key:"pause",value:function e(){this._mediaElement.pause()}},{key:"_onvLoadedMetadata",value:function e(t){if(this._pendingSeekTime!=null){this._mediaElement.currentTime=this._pendingSeekTime;this._pendingSeekTime=null}this._emitter.emit(u.default.MEDIA_INFO,this.mediaInfo)}},{key:"_reportStatisticsInfo",value:function e(){this._emitter.emit(u.default.STATISTICS_INFO,this.statisticsInfo)}},{key:"type",get:function e(){return this._type}},{key:"buffered",get:function e(){return this._mediaElement.buffered}},{key:"duration",get:function e(){return this._mediaElement.duration}},{key:"volume",get:function e(){return this._mediaElement.volume},set:function e(t){this._mediaElement.volume=t}},{key:"muted",get:function e(){return this._mediaElement.muted},set:function e(t){this._mediaElement.muted=t}},{key:"currentTime",get:function e(){if(this._mediaElement){return this._mediaElement.currentTime}return 0},set:function e(t){if(this._mediaElement){this._mediaElement.currentTime=t}else{this._pendingSeekTime=t}}},{key:"mediaInfo",get:function e(){var t=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/";var r={mimeType:t+this._mediaDataSource.type};if(this._mediaElement){r.duration=Math.floor(this._mediaElement.duration*1e3);if(this._mediaElement instanceof HTMLVideoElement){r.width=this._mediaElement.videoWidth;r.height=this._mediaElement.videoHeight}}return r}},{key:"statisticsInfo",get:function e(){var t={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement)){return t}var r=true;var i=0;var n=0;if(this._mediaElement.getVideoPlaybackQuality){var a=this._mediaElement.getVideoPlaybackQuality();i=a.totalVideoFrames;n=a.droppedVideoFrames}else if(this._mediaElement.webkitDecodedFrameCount!=undefined){i=this._mediaElement.webkitDecodedFrameCount;n=this._mediaElement.webkitDroppedFrameCount}else{r=false}if(r){t.decodedFrames=i;t.droppedFrames=n}return t}}]);return r}();r.default=c},{"../config.js":5,"../utils/exception.js":40,"./player-events.js":35,events:2}],34:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.ErrorDetails=r.ErrorTypes=undefined;var i=e("../io/loader.js");var n=e("../demux/demux-errors.js");var a=s(n);function s(e){return e&&e.__esModule?e:{default:e}}var o=r.ErrorTypes={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"};var u=r.ErrorDetails={NETWORK_EXCEPTION:i.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:i.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:i.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:i.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:a.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:a.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:a.default.CODEC_UNSUPPORTED}},{"../demux/demux-errors.js":16,"../io/loader.js":24}],35:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};r.default=i},{}],36:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e)}i(e,null,[{key:"getSilentFrame",value:function e(t,r){if(t==="mp4a.40.2"){if(r===1){return new Uint8Array([0,200,0,128,35,128])}else if(r===2){return new Uint8Array([33,0,73,144,2,25,0,35,128])}else if(r===3){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142])}else if(r===4){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56])}else if(r===5){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56])}else if(r===6){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}}else{if(r===1){return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}else if(r===2){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}else if(r===3){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}return null}}]);return e}();r.default=a},{}],37:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function h(){n(this,h)}i(h,null,[{key:"init",value:function e(){h.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var t in h.types){if(h.types.hasOwnProperty(t)){h.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]}}var r=h.constants={};r.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]);r.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]);r.STTS=new Uint8Array([0,0,0,0,0,0,0,0]);r.STSC=r.STCO=r.STTS;r.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);r.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);r.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);r.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);r.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);r.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function e(t){var r=8;var i=null;var n=Array.prototype.slice.call(arguments,1);var a=n.length;for(var s=0;s<a;s++){r+=n[s].byteLength}i=new Uint8Array(r);i[0]=r>>>24&255;i[1]=r>>>16&255;i[2]=r>>>8&255;i[3]=r&255;i.set(t,4);var o=8;for(var u=0;u<a;u++){i.set(n[u],o);o+=n[u].byteLength}return i}},{key:"generateInitSegment",value:function e(t){var r=h.box(h.types.ftyp,h.constants.FTYP);var i=h.moov(t);var n=new Uint8Array(r.byteLength+i.byteLength);n.set(r,0);n.set(i,r.byteLength);return n}},{key:"moov",value:function e(t){var r=h.mvhd(t.timescale,t.duration);var i=h.trak(t);var n=h.mvex(t);return h.box(h.types.moov,r,i,n)}},{key:"mvhd",value:function e(t,r){return h.box(h.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,t&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function e(t){return h.box(h.types.trak,h.tkhd(t),h.mdia(t))}},{key:"tkhd",value:function e(t){var r=t.id,i=t.duration;var n=t.presentWidth,a=t.presentHeight;return h.box(h.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,n&255,0,0,a>>>8&255,a&255,0,0]))}},{key:"mdia",value:function e(t){return h.box(h.types.mdia,h.mdhd(t),h.hdlr(t),h.minf(t))}},{key:"mdhd",value:function e(t){var r=t.timescale;var i=t.duration;return h.box(h.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,85,196,0,0]))}},{key:"hdlr",value:function e(t){var r=null;if(t.type==="audio"){r=h.constants.HDLR_AUDIO}else{r=h.constants.HDLR_VIDEO}return h.box(h.types.hdlr,r)}},{key:"minf",value:function e(t){var r=null;if(t.type==="audio"){r=h.box(h.types.smhd,h.constants.SMHD)}else{r=h.box(h.types.vmhd,h.constants.VMHD)}return h.box(h.types.minf,r,h.dinf(),h.stbl(t))}},{key:"dinf",value:function e(){var t=h.box(h.types.dinf,h.box(h.types.dref,h.constants.DREF));return t}},{key:"stbl",value:function e(t){var r=h.box(h.types.stbl,h.stsd(t),h.box(h.types.stts,h.constants.STTS),h.box(h.types.stsc,h.constants.STSC),h.box(h.types.stsz,h.constants.STSZ),h.box(h.types.stco,h.constants.STCO));return r}},{key:"stsd",value:function e(t){if(t.type==="audio"){if(t.codec==="mp3"){return h.box(h.types.stsd,h.constants.STSD_PREFIX,h.mp3(t))}return h.box(h.types.stsd,h.constants.STSD_PREFIX,h.mp4a(t))}else{return h.box(h.types.stsd,h.constants.STSD_PREFIX,h.avc1(t))}}},{key:"mp3",value:function e(t){var r=t.channelCount;var i=t.audioSampleRate;var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,i>>>8&255,i&255,0,0]);return h.box(h.types[".mp3"],n)}},{key:"mp4a",value:function e(t){var r=t.channelCount;var i=t.audioSampleRate;var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,i>>>8&255,i&255,0,0]);return h.box(h.types.mp4a,n,h.esds(t))}},{key:"esds",value:function e(t){var r=t.config||[];var i=r.length;var n=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(r).concat([6,1,2]));return h.box(h.types.esds,n)}},{key:"avc1",value:function e(t){var r=t.avcc;var i=t.codecWidth,n=t.codecHeight;var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>>8&255,i&255,n>>>8&255,n&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return h.box(h.types.avc1,a,h.box(h.types.avcC,r))}},{key:"mvex",value:function e(t){return h.box(h.types.mvex,h.trex(t))}},{key:"trex",value:function e(t){var r=t.id;var i=new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return h.box(h.types.trex,i)}},{key:"moof",value:function e(t,r){return h.box(h.types.moof,h.mfhd(t.sequenceNumber),h.traf(t,r))}},{key:"mfhd",value:function e(t){var r=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,t&255]);return h.box(h.types.mfhd,r)}},{key:"traf",value:function e(t,r){var i=t.id;var n=h.box(h.types.tfhd,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255]));var a=h.box(h.types.tfdt,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255]));var s=h.sdtp(t);var o=h.trun(t,s.byteLength+16+16+8+16+8+8);return h.box(h.types.traf,n,a,o,s)}},{key:"sdtp",value:function e(t){var r=t.samples||[];var i=r.length;var n=new Uint8Array(4+i);for(var a=0;a<i;a++){var s=r[a].flags;n[a+4]=s.isLeading<<6|s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy}return h.box(h.types.sdtp,n)}},{key:"trun",value:function e(t,r){var i=t.samples||[];var n=i.length;var a=12+16*n;var s=new Uint8Array(a);r+=8+a;s.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0);for(var o=0;o<n;o++){var u=i[o].duration;var l=i[o].size;var f=i[o].flags;var d=i[o].cts;s.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.isNonSync,0,0,d>>>24&255,d>>>16&255,d>>>8&255,d&255],12+16*o)}return h.box(h.types.trun,s)}},{key:"mdat",value:function e(t){return h.box(h.types.mdat,t)}}]);return h}();a.init();r.default=a},{}],38:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var n=e("../utils/logger.js");var $=l(n);var a=e("./mp4-generator.js");var ee=l(a);var s=e("./aac-silent.js");var te=l(s);var o=e("../utils/browser.js");var re=l(o);var ie=e("../core/media-segment-info.js");var u=e("../utils/exception.js");function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var d=function(){function t(e){f(this,t);this.TAG="MP4Remuxer";this._config=e;this._isLive=e.isLive===true?true:false;this._dtsBase=-1;this._dtsBaseInited=false;this._audioDtsBase=Infinity;this._videoDtsBase=Infinity;this._audioNextDts=undefined;this._videoNextDts=undefined;this._audioStashedLastSample=null;this._videoStashedLastSample=null;this._audioMeta=null;this._videoMeta=null;this._audioSegmentInfoList=new ie.MediaSegmentInfoList("audio");this._videoSegmentInfoList=new ie.MediaSegmentInfoList("video");this._onInitSegment=null;this._onMediaSegment=null;this._forceFirstIDR=re.default.chrome&&(re.default.version.major<50||re.default.version.major===50&&re.default.version.build<2661)?true:false;this._fillSilentAfterSeek=re.default.msedge||re.default.msie;this._mp3UseMpegAudio=!re.default.firefox;this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}i(t,[{key:"destroy",value:function e(){this._dtsBase=-1;this._dtsBaseInited=false;this._audioMeta=null;this._videoMeta=null;this._audioSegmentInfoList.clear();this._audioSegmentInfoList=null;this._videoSegmentInfoList.clear();this._videoSegmentInfoList=null;this._onInitSegment=null;this._onMediaSegment=null}},{key:"bindDataSource",value:function e(t){t.onDataAvailable=this.remux.bind(this);t.onTrackMetadata=this._onTrackMetadataReceived.bind(this);return this}},{key:"insertDiscontinuity",value:function e(){this._audioNextDts=this._videoNextDts=undefined}},{key:"seek",value:function e(t){this._audioStashedLastSample=null;this._videoStashedLastSample=null;this._videoSegmentInfoList.clear();this._audioSegmentInfoList.clear()}},{key:"remux",value:function e(t,r){if(!this._onMediaSegment){throw new u.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!")}if(!this._dtsBaseInited){this._calculateDtsBase(t,r)}this._remuxVideo(r);this._remuxAudio(t)}},{key:"_onTrackMetadataReceived",value:function e(t,r){var i=null;var n="mp4";var a=r.codec;if(t==="audio"){this._audioMeta=r;if(r.codec==="mp3"&&this._mp3UseMpegAudio){n="mpeg";a="";i=new Uint8Array}else{i=ee.default.generateInitSegment(r)}}else if(t==="video"){this._videoMeta=r;i=ee.default.generateInitSegment(r)}else{return}if(!this._onInitSegment){throw new u.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!")}this._onInitSegment(t,{type:t,data:i.buffer,codec:a,container:t+"/"+n,mediaDuration:r.duration})}},{key:"_calculateDtsBase",value:function e(t,r){if(this._dtsBaseInited){return}if(t.samples&&t.samples.length){this._audioDtsBase=t.samples[0].dts}if(r.samples&&r.samples.length){this._videoDtsBase=r.samples[0].dts}this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase);this._dtsBaseInited=true}},{key:"flushStashedSamples",value:function e(){var t=this._videoStashedLastSample;var r=this._audioStashedLastSample;var i={type:"video",id:1,sequenceNumber:0,samples:[],length:0};if(t!=null){i.samples.push(t);i.length=t.length}var n={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};if(r!=null){n.samples.push(r);n.length=r.length}this._videoStashedLastSample=null;this._audioStashedLastSample=null;this._remuxVideo(i,true);this._remuxAudio(n,true)}},{key:"_remuxAudio",value:function e(t,r){if(this._audioMeta==null){return}var i=t;var n=i.samples;var a=undefined;var s=-1,o=-1,u=-1;var l=this._audioMeta.refSampleDuration;var f=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio;var d=this._dtsBaseInited&&this._audioNextDts===undefined;var h=false;if(!n||n.length===0){return}if(n.length===1&&!r){return}var c=0;var _=null;var v=0;if(f){c=0;v=i.length}else{c=8;v=8+i.length}var m=null;if(n.length>1){m=n.pop();v-=m.length}if(this._audioStashedLastSample!=null){var p=this._audioStashedLastSample;this._audioStashedLastSample=null;n.unshift(p);v+=p.length}if(m!=null){this._audioStashedLastSample=m}var g=n[0].dts-this._dtsBase;if(this._audioNextDts){a=g-this._audioNextDts}else{if(this._audioSegmentInfoList.isEmpty()){a=0;if(this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()){if(this._audioMeta.originalCodec!=="mp3"){h=true}}}else{var y=this._audioSegmentInfoList.getLastSampleBefore(g);if(y!=null){var E=g-(y.originalDts+y.duration);if(E<=3){E=0}var b=y.dts+y.duration+E;a=g-b}else{a=0}}}if(h){var S=g-a;var k=this._videoSegmentInfoList.getLastSegmentBefore(g);if(k!=null&&k.beginDts<S){var L=te.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(L){var w=k.beginDts;var R=S-k.beginDts;$.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+w+", duration: "+R);n.unshift({unit:L,dts:w,pts:w});v+=L.byteLength}}else{h=false}}var A=[];for(var T=0;T<n.length;T++){var O=n[T];var C=O.unit;var I=O.dts-this._dtsBase;var D=I-a;if(s===-1){s=D}var x=0;if(T!==n.length-1){var M=n[T+1].dts-this._dtsBase-a;x=M-D}else{if(m!=null){var B=m.dts-this._dtsBase-a;x=B-D}else if(A.length>=1){x=A[A.length-1].duration}else{x=Math.floor(l)}}var j=false;var P=null;if(x>l*1.5&&this._audioMeta.codec!=="mp3"&&this._fillAudioTimestampGap&&!re.default.safari){j=true;var U=Math.abs(x-l);var N=Math.ceil(U/l);var F=D+l;$.default.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. "+"Silent frames will be generated to avoid unsync.\n"+("dts: "+(D+x)+" ms, expected: "+(D+Math.round(l))+" ms, ")+("delta: "+Math.round(U)+" ms, generate: "+N+" frames"));var G=te.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(G==null){$.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"));G=C}P=[];for(var V=0;V<N;V++){var z=Math.round(F);if(P.length>0){var H=P[P.length-1];H.duration=z-H.dts}var K={dts:z,pts:z,cts:0,unit:G,size:G.byteLength,duration:0,originalDts:I,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};P.push(K);v+=K.size;F+=l}var q=P[P.length-1];q.duration=D+x-q.dts;x=Math.round(l)}A.push({dts:D,pts:D,cts:0,unit:O.unit,size:O.unit.byteLength,duration:x,originalDts:I,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}});if(j){A.push.apply(A,P)}}if(f){_=new Uint8Array(v)}else{_=new Uint8Array(v);_[0]=v>>>24&255;_[1]=v>>>16&255;_[2]=v>>>8&255;_[3]=v&255;_.set(ee.default.types.mdat,4)}for(var W=0;W<A.length;W++){var X=A[W].unit;_.set(X,c);c+=X.byteLength}var Y=A[A.length-1];o=Y.dts+Y.duration;this._audioNextDts=o;var Z=new ie.MediaSegmentInfo;Z.beginDts=s;Z.endDts=o;Z.beginPts=s;Z.endPts=o;Z.originalBeginDts=A[0].originalDts;Z.originalEndDts=Y.originalDts+Y.duration;Z.firstSample=new ie.SampleInfo(A[0].dts,A[0].pts,A[0].duration,A[0].originalDts,false);Z.lastSample=new ie.SampleInfo(Y.dts,Y.pts,Y.duration,Y.originalDts,false);if(!this._isLive){this._audioSegmentInfoList.append(Z)}i.samples=A;i.sequenceNumber++;var Q=null;if(f){Q=new Uint8Array}else{Q=ee.default.moof(i,s)}i.samples=[];i.length=0;var J={type:"audio",data:this._mergeBoxes(Q,_).buffer,sampleCount:A.length,info:Z};if(f&&d){J.timestampOffset=s}this._onMediaSegment("audio",J)}},{key:"_remuxVideo",value:function e(t,r){if(this._videoMeta==null){return}var i=t;var n=i.samples;var a=undefined;var s=-1,o=-1;var u=-1,l=-1;if(!n||n.length===0){return}if(n.length===1&&!r){return}var f=8;var d=null;var h=8+t.length;var c=null;if(n.length>1){c=n.pop();h-=c.length}if(this._videoStashedLastSample!=null){var _=this._videoStashedLastSample;this._videoStashedLastSample=null;n.unshift(_);h+=_.length}if(c!=null){this._videoStashedLastSample=c}var v=n[0].dts-this._dtsBase;if(this._videoNextDts){a=v-this._videoNextDts}else{if(this._videoSegmentInfoList.isEmpty()){a=0}else{var m=this._videoSegmentInfoList.getLastSampleBefore(v);if(m!=null){var p=v-(m.originalDts+m.duration);if(p<=3){p=0}var g=m.dts+m.duration+p;a=v-g}else{a=0}}}var y=new ie.MediaSegmentInfo;var E=[];for(var b=0;b<n.length;b++){var S=n[b];var k=S.dts-this._dtsBase;var L=S.isKeyframe;var w=k-a;var R=S.cts;var A=w+R;if(s===-1){s=w;u=A}var T=0;if(b!==n.length-1){var O=n[b+1].dts-this._dtsBase-a;T=O-w}else{if(c!=null){var C=c.dts-this._dtsBase-a;T=C-w}else if(E.length>=1){T=E[E.length-1].duration}else{T=Math.floor(this._videoMeta.refSampleDuration)}}if(L){var I=new ie.SampleInfo(w,A,T,S.dts,true);I.fileposition=S.fileposition;y.appendSyncPoint(I)}E.push({dts:w,pts:A,cts:R,units:S.units,size:S.length,isKeyframe:L,duration:T,originalDts:k,flags:{isLeading:0,dependsOn:L?2:1,isDependedOn:L?1:0,hasRedundancy:0,isNonSync:L?0:1}})}d=new Uint8Array(h);d[0]=h>>>24&255;d[1]=h>>>16&255;d[2]=h>>>8&255;d[3]=h&255;d.set(ee.default.types.mdat,4);for(var D=0;D<E.length;D++){var x=E[D].units;while(x.length){var M=x.shift();var B=M.data;d.set(B,f);f+=B.byteLength}}var j=E[E.length-1];o=j.dts+j.duration;l=j.pts+j.duration;this._videoNextDts=o;y.beginDts=s;y.endDts=o;y.beginPts=u;y.endPts=l;y.originalBeginDts=E[0].originalDts;y.originalEndDts=j.originalDts+j.duration;y.firstSample=new ie.SampleInfo(E[0].dts,E[0].pts,E[0].duration,E[0].originalDts,E[0].isKeyframe);y.lastSample=new ie.SampleInfo(j.dts,j.pts,j.duration,j.originalDts,j.isKeyframe);if(!this._isLive){this._videoSegmentInfoList.append(y)}i.samples=E;i.sequenceNumber++;if(this._forceFirstIDR){var P=E[0].flags;P.dependsOn=2;P.isNonSync=0}var U=ee.default.moof(i,s);i.samples=[];i.length=0;this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(U,d).buffer,sampleCount:E.length,info:y})}},{key:"_mergeBoxes",value:function e(t,r){var i=new Uint8Array(t.byteLength+r.byteLength);i.set(t,0);i.set(r,t.byteLength);return i}},{key:"onInitSegment",get:function e(){return this._onInitSegment},set:function e(t){this._onInitSegment=t}},{key:"onMediaSegment",get:function e(){return this._onMediaSegment},set:function e(t){this._onMediaSegment=t}}]);return t}();r.default=d},{"../core/media-segment-info.js":8,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./aac-silent.js":36,"./mp4-generator.js":37}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var d={};function i(){var e=self.navigator.userAgent.toLowerCase();var t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[];var r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[];var i={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:r[0]||""};var n={};if(i.browser){n[i.browser]=true;var a=i.majorVersion.split(".");n.version={major:parseInt(i.majorVersion,10),string:i.version};if(a.length>1){n.version.minor=parseInt(a[1],10)}if(a.length>2){n.version.build=parseInt(a[2],10)}}if(i.platform){n[i.platform]=true}if(n.chrome||n.opr||n.safari){n.webkit=true}if(n.rv||n.iemobile){if(n.rv){delete n.rv}var s="msie";i.browser=s;n[s]=true}if(n.edge){delete n.edge;var o="msedge";i.browser=o;n[o]=true}if(n.opr){var u="opera";i.browser=u;n[u]=true}if(n.safari&&n.android){var l="android";i.browser=l;n[l]=true}n.name=i.browser;n.platform=i.platform;for(var f in d){if(d.hasOwnProperty(f)){delete d[f]}}Object.assign(d,n)}i();r.default=d},{}],40:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();function n(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function a(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=r.RuntimeException=function(){function t(e){s(this,t);this._message=e}i(t,[{key:"toString",value:function e(){return this.name+": "+this.message}},{key:"name",get:function e(){return"RuntimeException"}},{key:"message",get:function e(){return this._message}}]);return t}();var u=r.IllegalStateException=function(e){a(t,e);function t(e){s(this,t);return n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}i(t,[{key:"name",get:function e(){return"IllegalStateException"}}]);return t}(o);var l=r.InvalidArgumentException=function(e){a(t,e);function t(e){s(this,t);return n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}i(t,[{key:"name",get:function e(){return"InvalidArgumentException"}}]);return t}(o);var f=r.NotImplementedException=function(e){a(t,e);function t(e){s(this,t);return n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}i(t,[{key:"name",get:function e(){return"NotImplementedException"}}]);return t}(o)},{}],41:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var n=e("events");var a=s(n);function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var u=function(){function n(){o(this,n)}i(n,null,[{key:"e",value:function e(t,r){if(!t||n.FORCE_GLOBAL_TAG)t=n.GLOBAL_TAG;var i="["+t+"] > "+r;if(n.ENABLE_CALLBACK){n.emitter.emit("log","error",i)}if(!n.ENABLE_ERROR){return}if(console.error){console.error(i)}else if(console.warn){console.warn(i)}else{console.log(i)}}},{key:"i",value:function e(t,r){if(!t||n.FORCE_GLOBAL_TAG)t=n.GLOBAL_TAG;var i="["+t+"] > "+r;if(n.ENABLE_CALLBACK){n.emitter.emit("log","info",i)}if(!n.ENABLE_INFO){return}if(console.info){console.info(i)}else{console.log(i)}}},{key:"w",value:function e(t,r){if(!t||n.FORCE_GLOBAL_TAG)t=n.GLOBAL_TAG;var i="["+t+"] > "+r;if(n.ENABLE_CALLBACK){n.emitter.emit("log","warn",i)}if(!n.ENABLE_WARN){return}if(console.warn){console.warn(i)}else{console.log(i)}}},{key:"d",value:function e(t,r){if(!t||n.FORCE_GLOBAL_TAG)t=n.GLOBAL_TAG;var i="["+t+"] > "+r;if(n.ENABLE_CALLBACK){n.emitter.emit("log","debug",i)}if(!n.ENABLE_DEBUG){return}if(console.debug){console.debug(i)}else{console.log(i)}}},{key:"v",value:function e(t,r){if(!t||n.FORCE_GLOBAL_TAG)t=n.GLOBAL_TAG;var i="["+t+"] > "+r;if(n.ENABLE_CALLBACK){n.emitter.emit("log","verbose",i)}if(!n.ENABLE_VERBOSE){return}console.log(i)}}]);return n}();u.GLOBAL_TAG="flv.js";u.FORCE_GLOBAL_TAG=false;u.ENABLE_ERROR=true;u.ENABLE_INFO=true;u.ENABLE_WARN=true;u.ENABLE_DEBUG=true;u.ENABLE_VERBOSE=true;u.ENABLE_CALLBACK=false;u.emitter=new a.default;r.default=u},{events:2}],42:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();var i=e("events");var a=u(i);var s=e("./logger.js");var o=u(s);function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var f=function(){function i(){l(this,i)}n(i,null,[{key:"getConfig",value:function e(){return{globalTag:o.default.GLOBAL_TAG,forceGlobalTag:o.default.FORCE_GLOBAL_TAG,enableVerbose:o.default.ENABLE_VERBOSE,enableDebug:o.default.ENABLE_DEBUG,enableInfo:o.default.ENABLE_INFO,enableWarn:o.default.ENABLE_WARN,enableError:o.default.ENABLE_ERROR,enableCallback:o.default.ENABLE_CALLBACK}}},{key:"applyConfig",value:function e(t){o.default.GLOBAL_TAG=t.globalTag;o.default.FORCE_GLOBAL_TAG=t.forceGlobalTag;o.default.ENABLE_VERBOSE=t.enableVerbose;o.default.ENABLE_DEBUG=t.enableDebug;o.default.ENABLE_INFO=t.enableInfo;o.default.ENABLE_WARN=t.enableWarn;o.default.ENABLE_ERROR=t.enableError;o.default.ENABLE_CALLBACK=t.enableCallback}},{key:"_notifyChange",value:function e(){var t=i.emitter;if(t.listenerCount("change")>0){var r=i.getConfig();t.emit("change",r)}}},{key:"registerListener",value:function e(t){i.emitter.addListener("change",t)}},{key:"removeListener",value:function e(t){i.emitter.removeListener("change",t)}},{key:"addLogListener",value:function e(t){o.default.emitter.addListener("log",t);if(o.default.emitter.listenerCount("log")>0){o.default.ENABLE_CALLBACK=true;i._notifyChange()}}},{key:"removeLogListener",value:function e(t){o.default.emitter.removeListener("log",t);if(o.default.emitter.listenerCount("log")===0){o.default.ENABLE_CALLBACK=false;i._notifyChange()}}},{key:"forceGlobalTag",get:function e(){return o.default.FORCE_GLOBAL_TAG},set:function e(t){o.default.FORCE_GLOBAL_TAG=t;i._notifyChange()}},{key:"globalTag",get:function e(){return o.default.GLOBAL_TAG},set:function e(t){o.default.GLOBAL_TAG=t;i._notifyChange()}},{key:"enableAll",get:function e(){return o.default.ENABLE_VERBOSE&&o.default.ENABLE_DEBUG&&o.default.ENABLE_INFO&&o.default.ENABLE_WARN&&o.default.ENABLE_ERROR},set:function e(t){o.default.ENABLE_VERBOSE=t;o.default.ENABLE_DEBUG=t;o.default.ENABLE_INFO=t;o.default.ENABLE_WARN=t;o.default.ENABLE_ERROR=t;i._notifyChange()}},{key:"enableDebug",get:function e(){return o.default.ENABLE_DEBUG},set:function e(t){o.default.ENABLE_DEBUG=t;i._notifyChange()}},{key:"enableVerbose",get:function e(){return o.default.ENABLE_VERBOSE},set:function e(t){o.default.ENABLE_VERBOSE=t;i._notifyChange()}},{key:"enableInfo",get:function e(){return o.default.ENABLE_INFO},set:function e(t){o.default.ENABLE_INFO=t;i._notifyChange()}},{key:"enableWarn",get:function e(){return o.default.ENABLE_WARN},set:function e(t){o.default.ENABLE_WARN=t;i._notifyChange()}},{key:"enableError",get:function e(){return o.default.ENABLE_ERROR},set:function e(t){o.default.ENABLE_ERROR=t;i._notifyChange()}}]);return i}();f.emitter=new a.default;r.default=f},{"./logger.js":41,events:2}],43:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e)}i(e,null,[{key:"install",value:function e(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e};Object.assign=Object.assign||function(e){if(e===undefined||e===null){throw new TypeError("Cannot convert undefined or null to object")}var t=Object(e);for(var r=1;r<arguments.length;r++){var i=arguments[r];if(i!==undefined&&i!==null){for(var n in i){if(i.hasOwnProperty(n)){t[n]=i[n]}}}}return t};if(typeof self.Promise!=="function"){t("es6-promise").polyfill()}}}]);return e}();a.install();r.default=a},{"es6-promise":1}],44:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function u(e,t,r){var i=e;if(t+r<i.length){while(r--){if((i[++t]&192)!==128)return false}return true}else{return false}}function i(e){var t=[];var r=e;var i=0;var n=e.length;while(i<n){if(r[i]<128){t.push(String.fromCharCode(r[i]));++i;continue}else if(r[i]<192){}else if(r[i]<224){if(u(r,i,1)){var a=(r[i]&31)<<6|r[i+1]&63;if(a>=128){t.push(String.fromCharCode(a&65535));i+=2;continue}}}else if(r[i]<240){if(u(r,i,2)){var s=(r[i]&15)<<12|(r[i+1]&63)<<6|r[i+2]&63;if(s>=2048&&(s&63488)!==55296){t.push(String.fromCharCode(s&65535));i+=3;continue}}}else if(r[i]<248){if(u(r,i,3)){var o=(r[i]&7)<<18|(r[i+1]&63)<<12|(r[i+2]&63)<<6|r[i+3]&63;if(o>65536&&o<1114112){o-=65536;t.push(String.fromCharCode(o>>>10|55296));t.push(String.fromCharCode(o&1023|56320));i+=4;continue}}}t.push(String.fromCharCode(65533));++i}return t.join("")}r.default=i},{}]},{},[21])(21)});